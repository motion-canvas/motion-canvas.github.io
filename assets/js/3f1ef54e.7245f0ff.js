(self.webpackChunk_motion_canvas_docs=self.webpackChunk_motion_canvas_docs||[]).push([[7815],{1532:e=>{function n(e){var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}n.keys=()=>[],n.resolve=n,n.id=1532,e.exports=n},9573:(e,n,t)=>{"use strict";t.d(n,{Z:()=>o});var a=t(2784);function o(){return a.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"currentColor"},a.createElement("path",{d:"M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"}))}},700:(e,n,t)=>{"use strict";t.d(n,{Z:()=>o});var a=t(2784);function o(){return a.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"currentColor"},a.createElement("path",{d:"M3 15h8v-2H3v2zm0 4h8v-2H3v2zm0-8h8V9H3v2zm0-6v2h8V5H3zm10 0h8v14h-8V5z"}))}},8015:(e,n,t)=>{"use strict";t.d(n,{Z:()=>o});var a=t(2784);function o(){return a.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"currentColor"},a.createElement("path",{d:"M4 15h16v-2H4v2zm0 4h16v-2H4v2zm0-8h16V9H4v2zm0-6v2h16V5H4z"}))}},4974:(e,n,t)=>{"use strict";t.d(n,{Z:()=>pe});var a=t(2784),o=t(8888),i=t(5565),r=t(1727),l=t(9387),s=t(7120),c=t(3947),d=t(6253);const m=s.Qf.define([{tag:d.pJ.comment,color:"var(--hl-comment)"},{tag:d.pJ.docComment,color:"var(--hl-comment)"},{tag:d.pJ.blockComment,color:"var(--hl-comment)"},{tag:d.pJ.keyword,color:"var(--hl-keyword)"},{tag:d.pJ.number,color:"var(--hl-number)"},{tag:d.pJ.inserted,color:"var(--hl-number)"},{tag:d.pJ.constant(d.pJ.propertyName),color:"var(--hl-constant)"},{tag:d.pJ.attributeName,color:"var(--hl-variable)"},{tag:d.pJ.variableName,color:"var(--hl-variable)"},{tag:d.pJ.propertyName,color:"var(--hl-variable)"},{tag:d.pJ.deleted,color:"var(--hl-string)"},{tag:d.pJ.string,color:"var(--hl-string)"},{tag:d.pJ.attributeValue,color:"var(--hl-string)"},{tag:d.pJ.tagName,color:"var(--hl-tag)"},{tag:d.pJ.typeName,color:"var(--hl-tag)"},{tag:d.pJ.punctuation,color:"var(--hl-punctuation)"},{tag:d.pJ.operator,color:"var(--hl-punctuation)"},{tag:d.pJ.function(d.pJ.variableName),color:"var(--hl-function)"},{tag:d.pJ.function(d.pJ.propertyName),color:"var(--hl-function)"},{tag:d.pJ.className,color:"var(--hl-class)"},{tag:d.pJ.character,color:"var(--hl-char)"}]),u=i.tk.theme({"&":{fontSize:"var(--ifm-code-font-size)",lineHeight:"21.04px",fontFamily:"var(--ifm-font-family-monospace)",color:"var(--hl-color)",backgroundColor:"var(--hl-background)"},"&.cm-focused .cm-cursor":{borderLeftColor:"var(--hl-color)"},"&.cm-focused":{outline:"none"},".cm-gutters":{backgroundColor:"var(--hl-background)",color:"var(--ifm-color-secondary-darkest)",borderRight:"1px solid var(--ifm-background-color)"},"& .cm-lineNumbers .cm-gutterElement":{paddingLeft:"var(--ifm-pre-padding)"},".cm-activeLineGutter":{backgroundColor:"var(--ifm-code-active-color)"},".cm-scroller":{fontFamily:"var(--ifm-font-family-monospace)",lineHeight:"var(--ifm-pre-line-height)",paddingTop:"var(--ifm-pre-padding)",paddingBottom:"var(--ifm-pre-padding)"},".cm-content":{padding:"0"},"& .cm-line":{paddingRight:"var(--ifm-pre-padding)"},"& .cm-selectionBackground, &.cm-focused .cm-selectionBackground, ::selection":{backgroundColor:"var(--ifm-code-selection-color)"},".cm-activeLine":{backgroundColor:"var(--ifm-code-active-color)"},".cm-selectionMatch":{backgroundColor:"var(--ifm-code-selection-color)"},".cm-foldPlaceholder":{backgroundColor:"var(--ifm-code-selection-color)",borderColor:"var(--ifm-color-emphasis-300)"},".cm-tooltip":{backgroundColor:"var(--ifm-background-surface-color)"}});var f=t(8128);function p(e){const[n,t]=(0,a.useState)(null==e?void 0:e.current);return(0,a.useEffect)((()=>e&&e.subscribe(t)),[e]),n}function h(){return a.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"currentColor"},a.createElement("path",{d:"M6 6h2v12H6zm3.5 6l8.5 6V6z"}))}function v(){return a.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"currentColor"},a.createElement("path",{d:"M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z"}))}function g(){return a.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"currentColor"},a.createElement("path",{d:"M8 5v14l11-7z"}))}function y(){return a.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"currentColor"},a.createElement("path",{d:"M6 19h4V5H6v14zm8-14v14h4V5h-4z"}))}var k=t(8015),w=t(700),b=t(9573),N=t(1263);const R=[];function x(e){Object.entries(e).forEach((e=>{let[n,t]=e;var a;R.push({label:n,type:"function"==typeof t?(a=t,a.prototype&&a.prototype.constructor.name?"class":"function"):"variable"})}))}N.Z.canUseDOM&&(import("@motion-canvas/core").then(x).catch(),import("@motion-canvas/2d").then(x).catch());let S=null,L=null,C=null,I=null,E=null,z=null,V=1,M=null;async function D(e,n,t,a){if(e!==E){var o;if(I&&z&&I.finalBuffer.parentElement===z)null==(o=z)||o.removeChild(I.finalBuffer);if(null==E||E(null),E=e,z=n,M=a,!S){const{Logger:e,Player:n,ProjectMetadata:t,Stage:a,ValueDispatcher:o,DefaultPlugin:i}=await import("@motion-canvas/core"),{makeScene2D:r}=await import("@motion-canvas/2d");L=r((function*(){yield})),L.onReplaced=new o(L),S={name:"fiddle",logger:new e,plugins:[i()],scenes:[L]},S.meta=new t(S),S.meta.shared.size.set(960),C=new n(S,{size:S.meta.shared.size.get()}),I=new a,I.configure({size:S.meta.shared.size.get()}),C.onRender.subscribe((async()=>{await I.render(C.playback.currentScene,C.playback.previousScene)})),C.onRecalculated.subscribe((()=>{var e;I.finalBuffer.parentElement!==z&&(null==(e=z)||e.append(I.finalBuffer),E(C))})),S.logger.onLogged.subscribe((e=>{"error"===e.level&&(null==M||M(`Runtime error: ${e.message}`))}))}return V!==t&&(S.meta.shared.size.set([960,Math.floor(960/t)]),L.onReplaced.current={...L.onReplaced.current,size:S.meta.shared.size.get()},I.configure({size:S.meta.shared.size.get()}),V=t),C.activate(),C.requestReset(),C}}const _="root_icgl",T="layoutControl_X__N",P="icon_brRG",F="active_qxTr",B="progress_HsLC",O="controls_R4ai",J="previewOnly_FFUw",H="section_UscS",Z="error_N64d",G="editor_xQGp",U="source_Dq6N",q="preview_C9cZ",A="button_ESGX",W="picker_Whdf",Q="codeOnly_lee0";var X=t(7243);class j extends Error{constructor(e,n){super(e),this.errors=n}}function $(e,n){const t=`${n}.tsx`,a=new Set,o=[];let i,r=null;try{i=X.transform(e,{filename:t,presets:["typescript",["react",{runtime:"automatic",importSource:"@motion-canvas/2d"}]],plugins:[e=>{let{types:n}=e;return{visitor:{ImportDeclaration(e){e.node.source.value.startsWith("@motion-canvas/core")&&(e.node.source.value="@motion-canvas/core"),e.node.source.value.startsWith("@motion-canvas/2d")&&(e.node.source.value="@motion-canvas/2d")},ReferencedIdentifier(e){const{node:t,scope:i}=e;n.isIdentifier(t)&&!i.hasBinding(t.name)&&(a.add(t.name),o.push({from:t.start,to:t.end,tooltip:`Cannot find name '${t.name}'.`}))}}}}]})}catch(l){const e=/(.*) \(\d+:\d+\)/.exec(l.message.slice(t.length+1));r=e?e[1]:l.message,l.loc&&o.push({from:l.pos,to:l.pos,tooltip:r})}if(o.length>0)throw new j(r??`Cannot find names: ${Array.from(a).join(", ")}\nDid you forget to import them?`,o);return i.code}const K=/ *\/\/ ?(\S+) ?(.*)/,Y=["highlight-next-line","highlight-start","highlight-end"];var ee=t(6277);function ne(e){var n;let{options:t,value:o,className:i,onChange:r}=e;const l=(0,a.useRef)(),s=(0,a.useRef)(),[c,d]=(0,a.useState)(!1);return(0,a.useEffect)((()=>{const e=e=>{l.current&&!l.current.contains(e.target)&&d(!1)};return document.addEventListener("mousedown",e),document.addEventListener("touchstart",e),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("touchstart",e)}}),[l]),a.createElement("div",{ref:l,className:(0,ee.Z)("dropdown dropdown--right",c&&"dropdown--show",i)},a.createElement("a",{ref:s,className:"navbar__link",href:"#",onClick:e=>{e.preventDefault(),d(!c)}},(null==(n=t.find((e=>e.value===o)))?void 0:n.name)??o),a.createElement("ul",{className:"dropdown__menu"},t.map(((e,n)=>a.createElement("li",{key:e.value},a.createElement("a",{href:"#",className:(0,ee.Z)("dropdown__link",o===e.value&&"dropdown__link--active"),onClick:n=>{n.preventDefault(),r(e.value),d(!1),s.current.focus()},onKeyDown:e=>{n!==t.length-1||"Tab"!==e.key||e.shiftKey||(e.preventDefault(),d(!1),s.current.focus())}},e.name))))))}const te="import ".length;function ae(e,n){let t=(0,s.qz)(e).topNode.firstChild,a=null;for(;t;){if(t.type.is("ImportDeclaration")){a=t;break}t=t.nextSibling}if(!a)return null;if(n){const t=e.doc.lineAt(a.from);if(t.from>n.to||t.to<n.from)return null}let o=a;for(;o;){const e=o.nextSibling;if(!e.type.is("ImportDeclaration"))break;o=e}return{from:a.from+te,to:o.to}}function oe(e){const{state:n}=e,t=ae(n);t&&e.dispatch({effects:[s.SW.of(t)]})}var ie=t(3181);const re=r.Py.define(),le=r.Py.define({map:(e,n)=>{let{from:t,to:a,tooltip:o}=e;return{from:n.mapPos(t),to:n.mapPos(a),tooltip:o}}}),se=i.p.mark({class:"cm-underline"}),ce=i.tk.baseTheme({".cm-underline":{textDecoration:"var(--ifm-color-danger-dark) wavy underline"}}),de=r.QQ.define({create:()=>i.p.none,update:(e,n)=>{e=e.map(n.changes);for(const t of n.effects){if(t.is(re)){e=e.update({filter:()=>!1});break}t.is(le)&&(e=e.update({add:[se.range(t.value.from,t.value.to)]}))}return e},provide:e=>i.tk.decorations.from(e)});class me extends r.uU{constructor(e){super(),this.tooltip=e}}const ue=r.QQ.define({create:()=>r.Xs.empty,update:(e,n)=>{e=e.map(n.changes);for(const t of n.effects){if(t.is(re)){e=e.update({filter:()=>!1});break}t.is(le)&&(e=e.update({add:[new me(t.value.tooltip).range(t.value.from,t.value.to)]}))}return e},provide:e=>(0,i.bF)(((n,t)=>{let a;return n.state.field(e,!1).between(t,t,((e,n,t)=>(a={pos:e,end:n,create:()=>{const e=document.createElement("div");return e.textContent=t.tooltip,{dom:e}}},!1))),a}))});function fe(e,n,t){const a=n.map((n=>(n.from===n.to&&(n=function(e,n){const t=(0,s.qz)(e).resolveInner(n,1);return{from:t.from,to:t.to}}(e.state,n.from)),le.of({tooltip:t,...n}))));return e.dispatch({effects:a}),!0}function pe(e){let{children:n,className:t,mode:d="editor",ratio:x="4"}=e;const[V,M]=(0,a.useState)(null),X=(0,a.useRef)(null),te=(0,a.useRef)(),le=(0,a.useRef)(),[se,me]=(0,a.useState)(d),{pathname:pe}=(0,ie.TH)(),[he,ve]=(0,a.useState)(null),ge=p(null==V?void 0:V.onDurationChanged),ye=p(null==V?void 0:V.onFrameChanged),ke=p(null==V?void 0:V.onStateChanged),[we,be]=(0,a.useState)(null),[Ne,Re]=(0,a.useState)(null),xe=(0,a.useMemo)((()=>{if(x.includes("/")){const e=x.split("/"),n=parseFloat(e[0])/parseFloat(e[1]);if(!isNaN(n))return n}const e=parseFloat(x);return isNaN(e)?4:e}),[x]),Se=async function(e,n){void 0===n&&(n=!0),await D(M,le.current,xe,ve);try{const o=await async function(e,n){const t=$(e,n);return(await import(URL.createObjectURL(new Blob([t],{type:"text/javascript"})))).default}(e.sliceString(0),pe);return a=o,L&&(L.onReplaced.current=a),Re(e),!n||null!=Ne&&Ne.eq(e)||le.current.animate((void 0===t&&(t=4),[{boxShadow:"0 0 0px 0 #ccc inset",easing:"cubic-bezier(0.33, 1, 0.68, 1)"},{boxShadow:`0 0 0px ${t}px #ccc inset`,easing:"cubic-bezier(0.32, 0, 0.67, 0)"},{boxShadow:"0 0 0px 0 #ccc inset"}]),{duration:300}),!0}catch(o){return o instanceof j&&fe(X.current,o.errors,o.message),ve(o.message),null==V||V.togglePlayback(!1),!1}var t,a},Le=async e=>{Ie(e);const n=function(e){const n=ae(e);let t=!1;return e.field(s.iQ,!1).between(n.from,n.to,(()=>(t=!0,!1))),t}(X.current.state);X.current.setState(Ee[e].state),await Se(Ee[e].state.doc),n&&oe(X.current)},[Ce,Ie]=(0,a.useState)(0),Ee=(0,a.useMemo)((()=>function(e){let n={name:"Default",lines:[]};const t=[n];for(const a of e.split("\n")){const e=K.exec(a);if(!e){n.lines.push(a);continue}const[,o,i]=e;Y.includes(o)||("snippet"===o?n.lines.length>0?(n={name:i,lines:[]},t.push(n)):n.name=i:n.lines.push(a))}return t}(n).map((e=>({name:e.name,state:r.yy.create({doc:r.xv.of(e.lines),extensions:[o.Xy,i.$f.of([c.oc,{key:"Mod-s",preventDefault:!0,run:e=>(Se(e.state.doc),!0)}]),i.tk.updateListener.of((e=>{be(e.state.doc),e.docChanged&&(ve(null),X.current.dispatch({effects:[re.of(null)]}))})),l.Lz.data.of({autocomplete:e=>{if("String"===(0,s.qz)(e.state).resolveInner(e.pos,-1).name)return;const n=e.matchBefore(/\w*/);return n.from!=n.to||e.explicit?{from:n.from,options:R}:null}}),s.rs.of(((e,n,t)=>ae(e,{from:n,to:t}))),[de,ue,ce],(0,l.eJ)({jsx:!0,typescript:!0}),(0,s.nF)(m),u]})})))),[n]);N.Z.canUseDOM||Ee.forEach((e=>{$(e.state.doc.sliceString(0),pe)})),(0,a.useEffect)((()=>(X.current=new i.tk({parent:te.current,state:Ee[Ce].state}),oe(X.current),async function(e,n,t,a){return E?null:D(e,n,t,a)}(M,le.current,xe,ve).then((async e=>{if(e){await Se(Ee[Ce].state.doc,!1)&&"code"!==se&&e.togglePlayback(!0)}})),()=>{E===M&&S&&(C.deactivate(),E=null,z=null,I.finalBuffer.remove()),X.current.destroy()})),[]);const ze=(0,a.useMemo)((()=>{const e=Ee[0].state,n=ae(e);let t=e.doc;return n&&(t=t.replace(n.from,n.to,r.xv.of(["..."]))),t.toString()+"\n"}),[Ee]),Ve=Ne&&we&&!we.eq(Ne),Me=we&&!we.eq(Ee[Ce].state.doc)||Ve;return a.createElement("div",{className:(0,ee.Z)(_,t,{[Q]:"code"===se,[J]:"preview"===se})},a.createElement("div",{className:T},a.createElement("button",{className:(0,ee.Z)(P,"code"===se&&F),onClick:()=>{me("code"),null==V||V.togglePlayback(!1)},title:"Source code"},a.createElement(k.Z,null)),a.createElement("button",{className:(0,ee.Z)(P,"editor"===se&&F),onClick:()=>me("editor"),title:"Editor with preview"},a.createElement(w.Z,null)),a.createElement("button",{className:(0,ee.Z)(P,"preview"===se&&F),onClick:()=>me("preview"),title:"Preview"},a.createElement(b.Z,null))),a.createElement("div",{className:q,style:{aspectRatio:x},ref:le},!V&&a.createElement("div",null,"Press play to preview the animation")),ge>0&&a.createElement("div",{className:B,style:{width:V?ye/ge*100+"%":0}}),a.createElement("div",{className:O},a.createElement("div",{className:H},Ve&&a.createElement("button",{onClick:()=>Se(X.current.state.doc),className:A},a.createElement("kbd",null,"CTRL"),a.createElement("kbd",null,"S"),a.createElement("small",null,"Update preview"))),a.createElement("div",{className:H},a.createElement("button",{className:P,onClick:()=>null==V?void 0:V.requestPreviousFrame()},a.createElement(h,null)),a.createElement("button",{className:P,onClick:async()=>{if(V){let e=!0;Ne||(e=await Se(X.current.state.doc)),e&&V.togglePlayback()}else{const e=await D(M,le.current,xe,ve);await Se(X.current.state.doc)&&e.togglePlayback(!0)}}},!V||((null==ke?void 0:ke.paused)??1)?a.createElement(g,null):a.createElement(y,null)),a.createElement("button",{className:P,onClick:()=>null==V?void 0:V.requestNextFrame()},a.createElement(v,null))),a.createElement("div",{className:H},1===Ee.length&&Me&&a.createElement("button",{className:A,onClick:()=>Le(0)},a.createElement("small",null,"Reset example")),Ee.length>1&&a.createElement(ne,{className:W,value:Me?-1:Ce,onChange:Le,options:Ee.map(((e,n)=>({value:n,name:e.name}))).concat(Me?{value:-1,name:"Custom"}:[])}))),he&&a.createElement("pre",{className:Z},he),a.createElement("div",{className:G,ref:te},a.createElement(f.Z,{className:U,language:"tsx"},"code"===se?Ee[Ce].state.doc.toString():ze)))}},6714:(e,n,t)=>{"use strict";t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>u,frontMatter:()=>r,metadata:()=>s,toc:()=>d});var a=t(7896),o=(t(2784),t(876)),i=t(4974);const r={sidebar_position:5,slug:"/filters-and-effects"},l="Filters and Effects",s={unversionedId:"advanced/filters-and-effects",id:"advanced/filters-and-effects",title:"Filters and Effects",description:"Because Motion Canvas is build on top of the Browser's 2D Rendering Context, we",source:"@site/docs/advanced/filters-and-effects.mdx",sourceDirName:"advanced",slug:"/filters-and-effects",permalink:"/docs/filters-and-effects",draft:!1,editUrl:"https://github.com/motion-canvas/motion-canvas/blob/main/packages/docs/docs/advanced/filters-and-effects.mdx",tags:[],version:"current",lastUpdatedBy:"Waldemar Lehner",sidebarPosition:5,frontMatter:{sidebar_position:5,slug:"/filters-and-effects"},sidebar:"docs",previous:{title:"Spawners",permalink:"/docs/spawners"},next:{title:"Authoring plugins",permalink:"/docs/plugins"}},c={},d=[{value:"Filters",id:"filters",level:2},{value:"Masking and composite operations",id:"masking-and-composite-operations",level:2},{value:"Cached nodes",id:"cached-nodes",level:2}],m={toc:d};function u(e){let{components:n,...t}=e;return(0,o.kt)("wrapper",(0,a.Z)({},m,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"filters-and-effects"},"Filters and Effects"),(0,o.kt)("p",null,"Because Motion Canvas is build on top of the Browser's 2D Rendering Context, we\ncan make use of several canvas operations that are provided by the Browser."),(0,o.kt)("h2",{id:"filters"},"Filters"),(0,o.kt)("p",null,"Filters let you apply various effects to your nodes. You can find all available\nfilters on\n",(0,o.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/filter"},"MDN"),"."),(0,o.kt)(i.Z,{mode:"preview",mdxType:"Fiddle"},"import {makeScene2D, Img, Txt} from '@motion-canvas/2d';\nimport {all, createRef, createSignal, linear} from '@motion-canvas/core';\n\nexport default makeScene2D(function* (view) {\n  view.fill('#141414');\n\n  const timePassed = createSignal(0);\n  const iconRef = createRef<Img>();\n  const currentEffectText = createSignal('');\n  yield view.add(\n    <>\n      <Img src={'/img/logo_dark.svg'} size={200} x={-200} ref={iconRef} />\n      <Txt\n        fill={'rgba(255, 255, 255, 0.6)'}\n        fontSize={20}\n        x={200}\n        text={() => 'Current Filter: ' + currentEffectText()}\n      />\n    </>,\n  );\n\n  function* filters() {\n    yield currentEffectText('Blur');\n    yield* iconRef().filters.blur(20, 1);\n    yield* iconRef().filters.blur(0, 1);\n    yield currentEffectText('Grayscale');\n    yield* iconRef().filters.grayscale(1, 1);\n    yield* iconRef().filters.grayscale(0, 1);\n    yield currentEffectText('Hue');\n    yield* iconRef().filters.hue(360, 2);\n    yield currentEffectText('Contrast');\n    yield* iconRef().filters.contrast(0, 1);\n    yield* iconRef().filters.contrast(1, 1);\n  }\n\n  yield* all(timePassed(4, 2 * 4, linear), filters());\n});\n"),(0,o.kt)("p",null,"Every node has a ",(0,o.kt)("inlineCode",{parentName:"p"},"filters")," property containing an array of\n",(0,o.kt)("a",{parentName:"p",href:"/api/2d/partials#Functions"},"filters")," that will be applied to the node. You can\ndeclare this array yourself, or use the ",(0,o.kt)("inlineCode",{parentName:"p"},"filters")," property to configure\nindividual filters. Both ways are shown in the following example:"),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"Some filters, like ",(0,o.kt)("inlineCode",{parentName:"p"},"opacity")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"drop-shadow"),", have their own dedicated\nproperties directly on the ",(0,o.kt)("a",{parentName:"p",href:"/api/2d/components/Node#opacity"},(0,o.kt)("inlineCode",{parentName:"a"},"Node")),", class.")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx",metastring:"editor",editor:!0},"// snippet Filters Property\nimport {Img, makeScene2D} from '@motion-canvas/2d';\nimport {createRef} from '@motion-canvas/core';\n\nexport default makeScene2D(function* (view) {\n  view.fill('#141414');\n\n  const iconRef = createRef<Img>();\n  yield view.add(<Img src={'/img/logo_dark.svg'} size={200} ref={iconRef} />);\n  // Modification happens by accessing the `filters` property.\n  // Individual filters don't need to be initialized. If a filter you set doesn't\n  // exists, it will be automatically created and added to the list of filters.\n  // If you have multiple filters of the same type, this will only\n  // modify the first instance (you can use the array method for more control).\n  yield* iconRef().filters.blur(10, 1);\n  yield* iconRef().filters.blur(0, 1);\n});\n\n// snippet Filters Array\nimport {makeScene2D, Img, blur} from '@motion-canvas/2d';\nimport {createSignal} from '@motion-canvas/core';\n\nexport default makeScene2D(function* (view) {\n  view.fill('#141414');\n\n  const blurSignal = createSignal(0);\n  yield view.add(\n    <Img\n      src={'/img/logo_dark.svg'}\n      size={200}\n      /* Modification happens by changing the Filters inside the 'filters' array */\n      filters={[blur(blurSignal)]}\n    />,\n  );\n  yield* blurSignal(10, 1);\n  yield* blurSignal(0, 1);\n});\n")),(0,o.kt)("p",null,"Keep in mind that the order in which you apply the effects does matter, as can\nbe seen in the following example:"),(0,o.kt)(i.Z,{mode:"preview",ratio:"3",mdxType:"Fiddle"},"import {\n  makeScene2D,\n  Circle,\n  Grid,\n  Layout,\n  Rect,\n  Txt,\n  contrast,\n  saturate,\n} from '@motion-canvas/2d';\nimport {createSignal, linear, map, waitFor} from '@motion-canvas/core';\n\nexport default makeScene2D(function* (view) {\n  view.fontFamily('monospace').fontSize(20).fill('#141414');\n  view.add(<Rect size={5000} fill={'#111'} />);\n\n  const t = createSignal(0);\n  const saturateValue = createSignal(1);\n  const contrastValue = createSignal(1);\n\n  view.add(\n    // Left Segment\n    <Layout x={-300} direction={'column'} alignItems={'center'} gap={20} layout>\n      <Circle\n        size={150}\n        fill={'#99c47a'}\n        filters={[saturate(saturateValue), contrast(contrastValue)]}\n      />\n      <Layout direction={'row'} gap={20}>\n        <Txt fill={'#ffa'}>saturation</Txt>\n        <Txt fill={'#aff'}>constrast</Txt>\n      </Layout>\n    </Layout>,\n  );\n\n  // Right Segment\n  yield view.add(\n    <Layout x={300} direction={'column'} alignItems={'center'} gap={20} layout>\n      <Circle\n        size={150}\n        fill={'#99c47a'}\n        filters={[contrast(contrastValue), saturate(saturateValue)]}\n      />\n      <Layout direction={'row'} gap={20}>\n        <Txt fill={'#aff'}>constrast</Txt>\n        <Txt fill={'#ffa'}>saturation</Txt>\n      </Layout>\n    </Layout>,\n  );\n\n  // Center Segment\n  view.add(\n    <Layout y={-10}>\n      <Grid size={200} stroke={'gray'} lineWidth={1} spacing={40} />\n      <Grid size={200} stroke={'#333'} lineWidth={1} spacing={20} />\n      <Rect size={200} stroke={'gray'} lineWidth={2} />\n      <Txt\n        fill={'white'}\n        text={'saturation'}\n        rotation={-90}\n        x={-115}\n        fill={'#ffa'}\n      />\n      <Txt fill={'white'} text={'contrast'} y={115} fill={'#aff'} />\n      <Txt fill={'white'} text={'1'} position={[-115, 100]} />\n      <Txt fill={'white'} text={'1'} position={[-100, 115]} />\n      <Txt fill={'white'} text={'5'} position={[-115, -90]} />\n      <Txt fill={'white'} text={'5'} position={[100, 115]} />\n      <Circle\n        x={() => map(-150, -100, contrastValue())}\n        y={() => map(150, 100, saturateValue())}\n        fill={'white'}\n        size={20}\n      />\n    </Layout>,\n  );\n\n  yield t(2, 8, linear);\n  yield* saturateValue(5, 2);\n  yield* contrastValue(5, 2);\n  yield* waitFor(1);\n  yield* saturateValue(1, 2);\n  yield* contrastValue(1, 2);\n});\n"),(0,o.kt)("h2",{id:"masking-and-composite-operations"},"Masking and composite operations"),(0,o.kt)("p",null,"Composite operations define how the thing we draw (source) interacts with what\nis already on the canvas (destination). Among other things, it allows us to\ndefine complex masks. MDN has a\n",(0,o.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/globalCompositeOperation#operations"},"great visualisation of all available composite operations"),"."),(0,o.kt)("p",null,'You can create a mask by treating one node as the "masking" / "stencil" layer,\nand another node as the "value" layer. The mask layer will define if the value\nlayer will be visible or not. The value layer will be what\'s actually visible in\nthe end.'),(0,o.kt)(i.Z,{mode:"preview",ratio:"3",mdxType:"Fiddle"},"import {\n  Grid,\n  Img,\n  Layout,\n  makeScene2D,\n  Node,\n  Rect,\n  Txt,\n} from '@motion-canvas/2d';\nimport {\n  all,\n  createRef,\n  createSignal,\n  Origin,\n  Vector2,\n  waitFor,\n} from '@motion-canvas/core';\n\nconst ImageSource =\n  'https://images.unsplash.com/photo-1685901088371-f498db7f8c46';\n\nexport default makeScene2D(function* (view) {\n  view.fontSize(20).fill('#141414');\n\n  const valuePosition = createSignal(new Vector2(150, -30));\n  const maskPosition = createSignal(new Vector2(-150, -30));\n\n  const maskLayerRotation = createSignal(0);\n  const valueLayerRotation = createSignal(0);\n\n  const fakeMaskLayerGroup = createRef<Node>();\n  const fakeValueLayerGroup = createRef<Node>();\n\n  // First show fake a Mask Layer. Funnily enough, this also makes use of masking!\n  yield view.add(\n    <Node ref={fakeMaskLayerGroup} opacity={0} cache>\n      <Img\n        src=\"/img/logo_dark.svg\"\n        size={200}\n        position={maskPosition}\n        rotation={maskLayerRotation}\n      />\n      <Grid\n        compositeOperation={'source-in'}\n        stroke={'white'}\n        width={1000}\n        height={400}\n        spacing={5}\n        lineWidth={1}\n      />\n    </Node>,\n  );\n  yield view.add(\n    <Node ref={fakeValueLayerGroup} opacity={0} cache>\n      {/*\n      We do not specifically need to use the Image here, a simple Rectangle would be enough.\n      It is however convenient because we get the correct aspect ratio.\n      */}\n      <Img\n        src={ImageSource}\n        width={360}\n        position={valuePosition}\n        rotation={valueLayerRotation}\n      />\n      <Grid\n        compositeOperation={'source-in'}\n        stroke={'#ff0'}\n        width={1000}\n        rotation={45}\n        height={1000}\n        spacing={5}\n        lineWidth={1}\n      />\n    </Node>,\n  );\n\n  // Legend (Bottom Center)\n  yield view.add(\n    <Rect\n      fill={'#1a1a1aa0'}\n      layout\n      direction={'row'}\n      gap={20}\n      padding={20}\n      bottom={() => view.getOriginDelta(Origin.Bottom)}\n    >\n      <Layout gap={5} alignItems={'center'}>\n        <Grid\n          stroke={'white'}\n          width={18}\n          height={18}\n          spacing={5}\n          lineWidth={1}\n        />\n        <Txt fill={'white'}>Hidden Stencil / Mask Layer</Txt>\n      </Layout>\n      <Layout gap={5} alignItems={'center'}>\n        <Grid\n          stroke={'#ff0'}\n          rotation={45}\n          width={18}\n          height={18}\n          spacing={5}\n          lineWidth={1}\n        />\n        <Txt fill={'white'}>Hidden Value Layer</Txt>\n      </Layout>\n    </Rect>,\n  );\n  yield* all(\n    fakeMaskLayerGroup().opacity(1, 1),\n    fakeValueLayerGroup().opacity(1, 1),\n  );\n  // Here comes the *actual* value and stencil mask. Because it got added last it will be ontop of the \"fake\" layers.\n  yield view.add(\n    <Node cache>\n      {/** Stencil / Mask Layer. It defines if the Value Layer is visible or not */}\n      <Img\n        src=\"/img/logo_dark.svg\"\n        size={200}\n        position={maskPosition}\n        rotation={maskLayerRotation}\n      />\n      {/** Value Layer. Anything from here will be visible if the Stencil Layer allows for it. */}\n      <Img\n        src={ImageSource}\n        width={360}\n        position={valuePosition}\n        rotation={valueLayerRotation}\n        compositeOperation={'source-in'}\n      />\n    </Node>,\n  );\n\n  // Visible Loop\n  yield* all(\n    maskPosition(new Vector2(0, -30), 2),\n    valuePosition(new Vector2(0, -30), 2),\n  );\n  yield* maskLayerRotation(360, 2);\n  yield* valueLayerRotation(-360, 2);\n  yield* waitFor(1);\n  yield* all(\n    maskPosition(new Vector2(-150, -30), 2),\n    valuePosition(new Vector2(150, -30), 2),\n  );\n  yield* all(\n    fakeMaskLayerGroup().opacity(0, 1),\n    fakeValueLayerGroup().opacity(0, 1),\n  );\n\n  // Hidden Loop\n  yield* all(\n    maskPosition(new Vector2(0, -30), 2),\n    valuePosition(new Vector2(0, -30), 2),\n  );\n  yield* maskLayerRotation(2 * 360, 2);\n  yield* valueLayerRotation(2 * -360, 2);\n  yield* waitFor(1);\n  yield* all(\n    maskPosition(new Vector2(-150, -30), 2),\n    valuePosition(new Vector2(150, -30), 2),\n  );\n});\n"),(0,o.kt)("p",null,"Any of the following composite operations can be used to create a mask:\n",(0,o.kt)("inlineCode",{parentName:"p"},"source-in"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"source-out"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"destination-in"),", and ",(0,o.kt)("inlineCode",{parentName:"p"},"destination-out"),". There is\nalso a ",(0,o.kt)("inlineCode",{parentName:"p"},"xor")," operation which can be helpful if you want two value layers that\nhide each other on overlap. Use the dropdown below to browse all examples."),(0,o.kt)(i.Z,{mdxType:"Fiddle"},"// snippet source-in\nimport {makeScene2D, Node, Img} from '@motion-canvas/2d';\nimport {createRef, linear} from '@motion-canvas/core';\n\n// Image by Marek Piwnicki (https://unsplash.com/photos/_4o-1pr2oqU)\nconst ImageSource =\n  'https://images.unsplash.com/photo-1685901088371-f498db7f8c46';\n\nexport default makeScene2D(function* (view) {\n  view.fill('#141414');\n\n  const maskRef = createRef<Img>();\n  const valueRef = createRef<Img>();\n\n  yield view.add(\n    <Node cache>\n      {/** Stencil / Mask Layer. It defines if the Value Layer is visible or not */}\n      <Img ref={maskRef} size={250} src=\"/img/logo_dark.svg\" />\n      {/** Value Layer. Anything from here will be visible if the Stencil Layer allows for it. */}\n      <Img\n        ref={valueRef}\n        x={100}\n        src={ImageSource}\n        width={600}\n        compositeOperation={'source-in'}\n      />\n    </Node>,\n  );\n\n  yield maskRef().rotation(360, 4, linear);\n  yield* valueRef().x(-100, 1.5).wait(0.5).to(100, 1.5).wait(0.5);\n});\n\n// snippet source-out\nimport {makeScene2D, Node, Img} from '@motion-canvas/2d';\nimport {createRef, linear} from '@motion-canvas/core';\n\n// Image by Marek Piwnicki (https://unsplash.com/photos/_4o-1pr2oqU)\nconst ImageSource =\n  'https://images.unsplash.com/photo-1685901088371-f498db7f8c46';\n\nexport default makeScene2D(function* (view) {\n  view.fill('#141414');\n\n  const maskRef = createRef<Img>();\n  const valueRef = createRef<Img>();\n\n  yield view.add(\n    <Node cache>\n      {/** Stencil / Mask Layer. It defines if the Value Layer is visible or not */}\n      <Img ref={maskRef} size={250} src=\"/img/logo_dark.svg\" />\n      {/** Value Layer. Anything from here will be visible if the Stencil Layer allows for it. */}\n      <Img\n        ref={valueRef}\n        x={100}\n        src={ImageSource}\n        width={600}\n        compositeOperation={'source-out'}\n      />\n    </Node>,\n  );\n\n  yield maskRef().rotation(360, 4, linear);\n  yield* valueRef().x(-100, 1.5).wait(0.5).to(100, 1.5).wait(0.5);\n});\n\n// snippet destination-in\nimport {makeScene2D, Node, Img} from '@motion-canvas/2d';\nimport {createRef, linear} from '@motion-canvas/core';\n\n// Image by Marek Piwnicki (https://unsplash.com/photos/_4o-1pr2oqU)\nconst ImageSource =\n  'https://images.unsplash.com/photo-1685901088371-f498db7f8c46';\n\nexport default makeScene2D(function* (view) {\n  view.fill('#141414');\n\n  const maskRef = createRef<Img>();\n  const valueRef = createRef<Img>();\n\n  yield view.add(\n    <Node cache>\n      {/** Value Layer. Anything from here will be visible if the Stencil Layer allows for it. */}\n      <Img ref={valueRef} x={100} src={ImageSource} width={600} />\n      {/** Stencil / Mask Layer. It defines if the Value Layer is visible or not */}\n      <Img\n        ref={maskRef}\n        size={250}\n        src=\"/img/logo_dark.svg\"\n        compositeOperation={'destination-in'}\n      />\n      {/** !!! Notice how the roles got reversed in comparison to source-in\n       * compositeOperation is now on the Mask, and the Value Layer lies above the Mask Layer.\n       */}\n    </Node>,\n  );\n\n  yield maskRef().rotation(360, 4, linear);\n  yield* valueRef().x(-100, 1.5).wait(0.5).to(100, 1.5).wait(0.5);\n});\n\n// snippet destination-out\nimport {makeScene2D, Node, Img} from '@motion-canvas/2d';\nimport {createRef, linear} from '@motion-canvas/core';\n\n// Image by Marek Piwnicki (https://unsplash.com/photos/_4o-1pr2oqU)\nconst ImageSource =\n  'https://images.unsplash.com/photo-1685901088371-f498db7f8c46';\n\nexport default makeScene2D(function* (view) {\n  view.fill('#141414');\n\n  const maskRef = createRef<Img>();\n  const valueRef = createRef<Img>();\n\n  yield view.add(\n    <Node cache>\n      {/** Value Layer. Anything from here will be visible if the Stencil Layer allows for it. */}\n      <Img ref={valueRef} x={100} src={ImageSource} width={600} />\n      {/** Stencil / Mask Layer. It defines if the Value Layer is visible or not */}\n      <Img\n        ref={maskRef}\n        size={250}\n        src=\"/img/logo_dark.svg\"\n        compositeOperation={'destination-out'}\n      />\n      {/** !!! Notice how the roles got reversed in comparison to source-out\n       * compositeOperation is now on the Mask, and the Value Layer lies above the Mask Layer.\n       */}\n    </Node>,\n  );\n\n  yield maskRef().rotation(360, 4, linear);\n  yield* valueRef().x(-100, 1.5).wait(0.5).to(100, 1.5).wait(0.5);\n});\n\n// snippet xor\nimport {makeScene2D, Node, Img, Circle} from '@motion-canvas/2d';\nimport {createRef, linear, easeInOutSine} from '@motion-canvas/core';\n\nexport default makeScene2D(function* (view) {\n  view.fill('#141414');\n\n  const maskRef = createRef<Img>();\n  const valueRef = createRef<Circle>();\n\n  yield view.add(\n    <Node cache>\n      {/** Stencil / Mask Layer. It defines if the Value Layer is visible or not */}\n      <Img ref={maskRef} size={250} src=\"/img/logo_dark.svg\" />\n      {/** Value Layer. Anything from here will be visible if the Stencil Layer allows for it. */}\n      <Circle\n        ref={valueRef}\n        size={0}\n        fill={'white'}\n        compositeOperation={'xor'}\n      />\n    </Node>,\n  );\n\n  yield maskRef().rotation(360, 4, linear);\n  yield* valueRef()\n    .size(300, 1.5, easeInOutSine)\n    .wait(0.5)\n    .to(0, 1.5)\n    .wait(0.5);\n});\n\n//snippet xor and source-in\nimport {Img, makeScene2D, Node, Circle} from '@motion-canvas/2d';\nimport {createRef, easeInOutSine, linear} from '@motion-canvas/core';\n\n/*\n * This example shows you that you can also nest composite operations.\n * Here we use a source-in to mask out an Image and use the Result to XOR with\n * the MC Icon\n */\n\n// Image by Marek Piwnicki (https://unsplash.com/photos/_4o-1pr2oqU)\nconst ImageSource =\n  'https://images.unsplash.com/photo-1685901088371-f498db7f8c46';\n\nexport default makeScene2D(function* (view) {\n  view.fill('#141414');\n\n  const maskRef = createRef<Img>();\n  const valueRef = createRef<Circle>();\n  const imageRef = createRef<Img>();\n\n  yield view.add(\n    <Node cache>\n      {/** Stencil / Mask Layer. It defines if the Value Layer is visible or not */}\n      <Img ref={maskRef} size={250} src=\"/img/logo_dark.svg\" />\n      {/** Value Layer (which in itself is generated from a composite operation)  */}\n      <Node cache compositeOperation={'xor'}>\n        <Circle ref={valueRef} size={0} fill={'white'} />\n        <Img\n          ref={imageRef}\n          width={600}\n          rotation={180}\n          src={ImageSource}\n          compositeOperation={'source-in'}\n        />\n      </Node>\n    </Node>,\n  );\n\n  yield maskRef().rotation(360, 4, linear);\n  yield imageRef().rotation(-360 + 180, 4, linear);\n  yield* valueRef()\n    .size(300, 1.5, easeInOutSine)\n    .wait(0.5)\n    .to(0, 1.5)\n    .wait(0.5);\n});\n"),(0,o.kt)("h2",{id:"cached-nodes"},"Cached nodes"),(0,o.kt)("p",null,"Both filters and composite operations require a cached\n",(0,o.kt)("a",{parentName:"p",href:"/api/2d/components/Node"},(0,o.kt)("inlineCode",{parentName:"a"},"Node")),". Filters can set it automatically, while\ncomposite operations require you to set it explicitly on an ancestor\n",(0,o.kt)("a",{parentName:"p",href:"/api/2d/components/Node"},(0,o.kt)("inlineCode",{parentName:"a"},"Node"))," (usually the parent node)."),(0,o.kt)("p",null,"A cached ",(0,o.kt)("a",{parentName:"p",href:"/api/2d/components/Node"},(0,o.kt)("inlineCode",{parentName:"a"},"Node"))," and its children are rendered on an\noffscreen canvas first, before getting added to the main scene.",(0,o.kt)("br",{parentName:"p"}),"\n",'For filters this is needed because they are applied to the entire canvas. By\ncreating a new canvas and moving the elements that should get affected by the\nfilters over, applying filters to the entire "new" canvas, and then moving back\nthe result, you effectively only apply the filters to the moved elements.'),(0,o.kt)("p",null,"To turn a ",(0,o.kt)("a",{parentName:"p",href:"/api/2d/components/Node"},(0,o.kt)("inlineCode",{parentName:"a"},"Node"))," into a cached node, simply pass the\n",(0,o.kt)("a",{parentName:"p",href:"/api/2d/components/NodeProps/#cache"},(0,o.kt)("inlineCode",{parentName:"a"},"cache"))," property"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},"<Node cache>...</Node>\n// or\n<Node cache={true}>...</Node>\n")),(0,o.kt)("p",null,"All components inherit from ",(0,o.kt)("a",{parentName:"p",href:"/api/2d/components/Node"},(0,o.kt)("inlineCode",{parentName:"a"},"Node")),", so you can set\nthe cache on all of them."))}u.isMDXComponent=!0}}]);