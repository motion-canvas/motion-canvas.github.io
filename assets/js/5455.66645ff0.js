"use strict";(self.webpackChunk_motion_canvas_docs=self.webpackChunk_motion_canvas_docs||[]).push([[5455],{5455:(t,e,s)=>{function i(t,e){void 0===e&&(e=document.createElement("canvas"));const s=e.getContext("2d",t);if(!s)throw new Error("Could not create a 2D context.");return s}function r(t,e,s){return t+(e-t)*s}function n(t,e,s){return s<t?t:s>e?e:s}var a,o,h;s.r(e),function(t){t[t.Vertical=1]="Vertical",t[t.Horizontal=2]="Horizontal"}(a||(a={})),function(t){t[t.Top=4]="Top",t[t.Bottom=8]="Bottom",t[t.Left=16]="Left",t[t.Right=32]="Right"}(o||(o={})),function(t){t[t.Middle=3]="Middle",t[t.Top=5]="Top",t[t.Bottom=9]="Bottom",t[t.Left=18]="Left",t[t.Right=34]="Right",t[t.TopLeft=20]="TopLeft",t[t.TopRight=36]="TopRight",t[t.BottomLeft=24]="BottomLeft",t[t.BottomRight=40]="BottomRight"}(h||(h={}));function c(t,e,s){return void 0===e&&(e=0),void 0===s&&(s=1),r(e,s,t=t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2)}function l(t,e){return void 0===t&&(t=7.5625),void 0===e&&(e=2.75),function(s,i,n){return void 0===i&&(i=0),void 0===n&&(n=1),s<1/e?s*=t*s:s=s<2/e?t*(s-=1.505/e)*s+.75:s<2.5/e?t*(s-=2.25/e)*s+.9375:t*(s-=2.625/e)*s+.984375,r(i,n,s)}}void 0===u&&(u=1.70158);var u;(function(t){void 0===t&&(t=1.70158)})(),function(t,e){void 0===t&&(t=1.70158),void 0===e&&(e=1.525)}(),function(t,e){void 0===t&&(t=7.5625),void 0===e&&(e=2.75);const s=l(t,e)}(),l(),function(t,e){void 0===t&&(t=7.5625),void 0===e&&(e=2.75);const s=l(t,e)}(),function(t){void 0===t&&(t=2.094395)}(),function(t){void 0===t&&(t=2.094395)}(),function(t){void 0===t&&(t=1.39626)}();function d(t){const e={[t.name]:t},s=Object.getOwnPropertyDescriptor(e,t.name);if(s){for(var i=arguments.length,r=new Array(i>1?i-1:0),n=1;n<i;n++)r[n-1]=arguments[n];for(let i=r.length-1;i>=0;i--)r[i](e,t.name,s)}}function p(t){return function(e,s,i){i.value.prototype.name=t??s,i.value.prototype.threadable=!0}}class f extends Error{constructor(t,e){super(t),this.remarks=e}}const y=[];function g(){const t=y.at(-1);if(!t)throw new f("The thread is not available in the current context.","<p><code>useThread()</code> can only be called from within generator functions.\n      It&#39;s not available during rendering.</p>\n");return t}function*m(t,e,s){const i=g(),r=i.time(),n=i.time()+t;for(e(0,0);n>i.fixed;){const s=i.fixed-r;s>0&&e(s/t,s),yield}i.time(n),e(1,t),null==s||s(1,t)}d(m,p());const v=[];function b(){const t=v.at(-1);if(!t)throw new Error("The scene is not available in the current context.");return t}function w(){var t;return(null==(t=v.at(-1))?void 0:t.logger)??console}function S(t,e){const s=Object.getPrototypeOf(t);s.threadable||(s.threadable=!0,s.name="string"==typeof e?e:function(t){return Object.getPrototypeOf(t).name??null}(e))}function k(t,e){let s;return"string"==typeof t?(s=e(),S(s,t)):(s=t(),S(s,s)),s}const x=[];function*T(t,e){void 0===t&&(t=0);const s=g(),i=function(){const t=x.at(-1);if(!t)throw new Error("The playback is not available in the current context.");return t}().framesToSeconds(1),r=s.time()+t;for(;r-i>s.fixed;)yield;s.time(r),e&&(yield*e)}d((function*(t,e){yield*T(function(t){const e=b(),s=g();return e.timeEvents.register(t,s.time())}(t)),e&&(yield*e)}),p()),d(T,p());class M{constructor(){this.subscribable=new C(this),this.subscribers=new Set}subscribe(t){return this.subscribers.add(t),()=>this.unsubscribe(t)}unsubscribe(t){this.subscribers.delete(t)}clear(){this.subscribers.clear()}notifySubscribers(t){return[...this.subscribers].map((e=>e(t)))}}class C{constructor(t){this.dispatcher=t}subscribe(t){return this.dispatcher.subscribe(t)}unsubscribe(t){this.dispatcher.unsubscribe(t)}}class I extends M{constructor(){super(...arguments),this.value=!1}raise(){this.value||(this.value=!0,this.notifySubscribers())}reset(){this.value=!1}isRaised(){return this.value}subscribe(t){const e=super.subscribe(t);return this.value&&t(),e}}class P{static collectPromise(t,e){void 0===e&&(e=null);const s={promise:t,value:e,stack:(new Error).stack},i=this.collectionStack.at(-1);return i&&(s.owner=i.owner),t.then((t=>{s.value=t,null==i||i.markDirty()})),this.promises.push(s),s}static hasPromises(){return this.promises.length>0}static async consumePromises(){const t=[...this.promises];return await Promise.all(t.map((t=>t.promise))),this.promises=this.promises.filter((e=>!t.includes(e))),t}constructor(t){this.owner=t,this.dependencies=new Set,this.event=new I,this.markDirty=()=>this.event.raise(),this.invokable=this.invoke.bind(this),Object.defineProperty(this.invokable,"context",{value:this}),Object.defineProperty(this.invokable,"toPromise",{value:this.toPromise.bind(this)})}invoke(){}startCollecting(){if(P.collectionSet.has(this))throw new f("A circular dependency occurred between signals.","This can happen when signals reference each other in a loop.\n        Try using the attached stack trace to locate said loop.");P.collectionSet.add(this),P.collectionStack.push(this)}finishCollecting(){if(P.collectionSet.delete(this),P.collectionStack.pop()!==this)throw new Error("collectStart/collectEnd was called out of order.")}clearDependencies(){this.dependencies.forEach((t=>t.unsubscribe(this.markDirty))),this.dependencies.clear()}collect(){const t=P.collectionStack.at(-1);t&&(t.dependencies.add(this.event.subscribable),this.event.subscribe(t.markDirty))}dispose(){this.clearDependencies(),this.event.clear(),this.owner=null}async toPromise(){do{await P.consumePromises(),this.invokable()}while(P.hasPromises());return this.invokable}}function R(t){return"function"==typeof t}function E(t,e){return R(t)?()=>e(t()):e(t)}P.collectionSet=new Set,P.collectionStack=[],P.promises=[];const D=Symbol.for("@motion-canvas/core/signals/default");class A extends P{constructor(t,e,s,i,r){void 0===s&&(s=void 0),void 0===i&&(i=t=>t),void 0===r&&(r={}),super(s),this.initial=t,this.interpolation=e,this.parser=i,Object.defineProperty(this.invokable,"reset",{value:this.reset.bind(this)}),Object.defineProperty(this.invokable,"save",{value:this.save.bind(this)}),Object.defineProperty(this.invokable,"isInitial",{value:this.isInitial.bind(this)}),void 0!==this.initial&&(this.current=this.initial,this.markDirty(),R(this.initial)||(this.last=this.parse(this.initial))),this.extensions={getter:this.getter.bind(this),setter:this.setter.bind(this),tweener:this.tweener.bind(this),...r}}toSignal(){return this.invokable}parse(t){return this.parser(t)}set(t){return this.extensions.setter(t),this.owner}setter(t){return t===D&&(t=this.initial),this.current===t||(this.current=t,this.markDirty(),this.clearDependencies(),R(t)||(this.last=this.parse(t))),this.owner}get(){return this.extensions.getter()}getter(){if(this.event.isRaised()&&R(this.current)){this.clearDependencies(),this.startCollecting();try{this.last=this.parse(this.current())}catch(s){var t;w().error({...(e=s,{message:e.message,stack:e.stack,remarks:e.remarks}),inspect:null==(t=this.owner)?void 0:t.key})}this.finishCollecting()}var e;return this.event.reset(),this.collect(),this.last}invoke(t,e,s,i){if(void 0===s&&(s=c),void 0===i&&(i=this.interpolation),void 0===t)return this.get();if(void 0===e)return this.set(t);return this.createQueue(s,i).to(t,e)}createQueue(t,e){var s=this;const i=this.get(),r=[],n=k("animation chain",(function*(){for(;r.length>0;)yield*r.shift()}));return n.to=function(i,a,o,h){return void 0===o&&(o=t),void 0===h&&(h=e),t=o,e=h,r.push(s.tween(i,a,o,h)),n},n.back=function(a,o,h){return void 0===o&&(o=t),void 0===h&&(h=e),t=o,e=h,r.push(s.tween(i,a,t,e)),n},n.wait=t=>(r.push(T(t)),n),n.run=t=>(r.push(t),n),n.do=t=>(r.push(k((function*(){t()}))),n),n}*tween(t,e,s,i){t===D&&(t=this.initial),yield*this.extensions.tweener(t,e,s,i),this.set(t)}*tweener(t,e,s,i){const r=this.get();yield*m(e,(e=>{this.set(i(r,this.parse(function(t){return R(t)?t():t}(t)),s(e)))}))}dispose(){super.dispose(),this.initial=void 0,this.current=void 0,this.last=void 0}reset(){return void 0!==this.initial&&this.set(this.initial),this.owner}save(){return this.set(this.get())}isInitial(){return this.collect(),this.current===this.initial}raw(){return this.current}}class q extends A{constructor(t,e,s,i,n,a){var o;void 0===n&&(n=void 0),void 0===a&&(a={}),super(void 0,i,n,e,a),this.entries=t,this.signals=[],this.parser=e;for(const h of t){let t,i;Array.isArray(h)?([t,i]=h,(o=i.context).owner??(o.owner=this)):(t=h,i=new A(E(s,(t=>e(t)[h])),r,n??this.invokable).toSignal()),this.signals.push([t,i]),Object.defineProperty(this.invokable,t,{value:i})}}toSignal(){return this.invokable}parse(t){return this.parser(t)}getter(){return this.parse(Object.fromEntries(this.signals.map((t=>{let[e,s]=t;return[e,s()]}))))}setter(t){if(R(t))for(const[e,s]of this.signals)s((()=>this.parser(t())[e]));else{const e=this.parse(t);for(const[t,s]of this.signals)s(e[t])}return this.owner}reset(){for(const[,t]of this.signals)t.reset();return this.owner}save(){for(const[,t]of this.signals)t.save();return this.owner}}const L=180/Math.PI,O=Math.PI/180;class z{static createSignal(t,e,s){return void 0===e&&(e=z.lerp),new q(["x","y"],(t=>new z(t)),t,e,s).toSignal()}static lerp(t,e,s){let i,n;return"number"==typeof s?i=n=s:(i=s.x,n=s.y),new z(r(t.x,e.x,i),r(t.y,e.y,n))}static arcLerp(t,e,s,i,a){return void 0===i&&(i=!1),a??(a=t.sub(e).ctg),z.lerp(t,e,function(t,e,s){let i=e;s>1?s=1/s:i=!i;const a=r(i?Math.acos(n(-1,1,1-t)):Math.asin(t),r(0,Math.PI/2,t),s);let o=Math.sin(a),h=1-Math.cos(a);return e&&([o,h]=[h,o]),new z(o,h)}(s,i,a))}static createArcLerp(t,e){return(s,i,r)=>z.arcLerp(s,i,r,t,e)}static fromOrigin(t){const e=new z;return t===h.Middle||(t&o.Left?e.x=-1:t&o.Right&&(e.x=1),t&o.Top?e.y=-1:t&o.Bottom&&(e.y=1)),e}static fromScalar(t){return new z(t,t)}static fromRadians(t){return new z(Math.cos(t),Math.sin(t))}static fromDegrees(t){return z.fromRadians(t*O)}static radians(t,e){return Math.atan2(e,t)}static degrees(t,e){return z.radians(t,e)*L}static magnitude(t,e){return Math.sqrt(t*t+e*e)}static squaredMagnitude(t,e){return t*t+e*e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}get magnitude(){return z.magnitude(this.x,this.y)}get squaredMagnitude(){return z.squaredMagnitude(this.x,this.y)}get normalized(){return this.scale(1/z.magnitude(this.x,this.y))}get safe(){return new z(isNaN(this.x)?0:this.x,isNaN(this.y)?0:this.y)}get flipped(){return new z(-this.x,-this.y)}get floored(){return new z(Math.floor(this.x),Math.floor(this.y))}get perpendicular(){return new z(this.y,-this.x)}get radians(){return z.radians(this.x,this.y)}get degrees(){return z.degrees(this.x,this.y)}get ctg(){return this.x/this.y}constructor(t,e){if(this.x=0,this.y=0,null!=t){if("object"!=typeof t)return this.x=t,void(this.y=e??t);if(Array.isArray(t))return this.x=t[0],void(this.y=t[1]);if("width"in t)return this.x=t.width,void(this.y=t.height);this.x=t.x,this.y=t.y}}lerp(t,e){return z.lerp(this,t,e)}getOriginOffset(t){const e=z.fromOrigin(t);return e.x*=this.x/2,e.y*=this.y/2,e}scale(t){return new z(this.x*t,this.y*t)}transformAsPoint(t){return new z(this.x*t.m11+this.y*t.m21+t.m41,this.x*t.m12+this.y*t.m22+t.m42)}transform(t){return new z(this.x*t.m11+this.y*t.m21,this.x*t.m12+this.y*t.m22)}mul(t){const e=new z(t);return new z(this.x*e.x,this.y*e.y)}div(t){const e=new z(t);return new z(this.x/e.x,this.y/e.y)}add(t){const e=new z(t);return new z(this.x+e.x,this.y+e.y)}sub(t){const e=new z(t);return new z(this.x-e.x,this.y-e.y)}dot(t){const e=new z(t);return this.x*e.x+this.y*e.y}mod(t){const e=new z(t);return new z(this.x%e.x,this.y%e.y)}addX(t){return new z(this.x+t,this.y)}addY(t){return new z(this.x,this.y+t)}toSymbol(){return z.symbol}toString(){return`Vector2(${this.x}, ${this.y})`}serialize(){return{x:this.x,y:this.y}}exactlyEquals(t){return this.x===t.x&&this.y===t.y}equals(t,e){return void 0===e&&(e=1e-6),Math.abs(this.x-t.x)<=e+Number.EPSILON&&Math.abs(this.y-t.y)<=e+Number.EPSILON}}z.symbol=Symbol.for("@motion-canvas/core/types/Vector2"),z.zero=new z,z.one=new z(1,1),z.right=new z(1,0),z.left=new z(-1,0),z.up=new z(0,1),z.down=new z(0,-1);class j{get canvasSize(){return this.size.scale(this.resolutionScale)}constructor(){this.background=null,this.resolutionScale=1,this.colorSpace="srgb",this.size=z.zero,this.finalBuffer=document.createElement("canvas"),this.currentBuffer=document.createElement("canvas"),this.previousBuffer=document.createElement("canvas");const t=this.colorSpace;this.context=i({colorSpace:t},this.finalBuffer),this.currentContext=i({colorSpace:t},this.currentBuffer),this.previousContext=i({colorSpace:t},this.previousBuffer)}configure(t){let{colorSpace:e=this.colorSpace,size:s=this.size,resolutionScale:r=this.resolutionScale,background:n=this.background}=t;e!==this.colorSpace&&(this.colorSpace=e,this.context=i({colorSpace:e},this.finalBuffer),this.currentContext=i({colorSpace:e},this.currentBuffer),this.previousContext=i({colorSpace:e},this.previousBuffer)),s.exactlyEquals(this.size)&&r===this.resolutionScale||(this.resolutionScale=r,this.size=s,this.resizeCanvas(this.context),this.resizeCanvas(this.currentContext),this.resizeCanvas(this.previousContext)),this.background="string"==typeof n?n:(null==n?void 0:n.serialize())??null}async render(t,e){e&&(this.transformCanvas(this.previousContext),await e.render(this.previousContext)),this.transformCanvas(this.currentContext),await t.render(this.currentContext);const s=this.canvasSize;this.context.clearRect(0,0,s.width,s.height),this.background&&(this.context.save(),this.context.fillStyle=this.background,this.context.fillRect(0,0,s.width,s.height),this.context.restore()),e&&this.context.drawImage(this.previousBuffer,0,0),this.context.drawImage(this.currentBuffer,0,0)}transformCanvas(t){const e=this.canvasSize.scale(.5);t.setTransform(this.resolutionScale,0,0,this.resolutionScale,e.x,e.y)}resizeCanvas(t){const e=this.canvasSize;t.canvas.width=e.width,t.canvas.height=e.height}}class N extends M{set current(t){this.value=t,this.notifySubscribers(t)}get current(){return this.value}constructor(t){super(),this.value=t,this.subscribable=new B(this)}subscribe(t,e){void 0===e&&(e=!0);const s=super.subscribe(t);return e&&t(this.value),s}}class B extends C{get current(){return this.dispatcher.current}subscribe(t,e){return void 0===e&&(e=!0),this.dispatcher.subscribe(t,e)}}var F;!function(t){t[t.Playing=0]="Playing",t[t.Rendering=1]="Rendering",t[t.Paused=2]="Paused",t[t.Presenting=3]="Presenting"}(F||(F={}));class Z{constructor(){this.frame=0,this.speed=1,this.fps=30,this.duration=0,this.finished=!1,this.slides=[],this.previousScene=null,this.state=F.Paused,this.currentSceneReference=null,this.scenes=new N([])}get onSceneChanged(){if(null===this.currentSceneReference)throw new Error("PlaybackManager has not been properly initialized");return this.currentSceneReference.subscribable}get onScenesRecalculated(){return this.scenes.subscribable}get currentScene(){if(null===this.currentSceneReference)throw new Error("PlaybackManager has not been properly initialized");return this.currentSceneReference.current}set currentScene(t){if(!t)throw new Error("Invalid scene.");this.currentSceneReference??(this.currentSceneReference=new N(t)),this.currentSceneReference.current=t}setup(t){this.scenes.current=t,this.currentScene=t[0]}async progress(){return this.finished=await this.next(),this.finished}async seek(t){if(t<=this.frame||this.currentScene.isCached()&&this.currentScene.lastFrame<t){const e=this.findBestScene(t);e!==this.currentScene?(this.previousScene=null,this.currentScene=e,this.frame=this.currentScene.firstFrame,await this.currentScene.reset()):this.frame>=t&&(this.previousScene=null,this.frame=this.currentScene.firstFrame,await this.currentScene.reset())}for(this.finished=!1;this.frame<t&&!this.finished;)this.finished=await this.next();return this.finished}async goBack(){let t=this.currentScene.slides.getCurrent();if(t&&this.currentScene.slides.isWaiting()){const e=this.slides.indexOf(t);t=this.slides[e-1]}await this.seekSlide(t)}async goForward(){const t=this.currentScene.slides.getCurrent(),e=this.slides.indexOf(t);await this.seekSlide(this.slides[e+1])}async goTo(t){await this.seekSlide(this.slides.find((e=>e.id===t)))}async seekSlide(t){if(void 0===t&&(t=null),!t)return;const{id:e,scene:s}=t;for((this.currentScene!==s||this.currentScene.slides.didHappen(e))&&(this.previousScene=null,this.currentScene=s,this.frame=this.currentScene.firstFrame,this.currentScene.slides.setTarget(e),await this.currentScene.reset()),this.finished=!1,this.currentScene.slides.setTarget(e);!this.currentScene.slides.isWaitingFor(e)&&!this.finished;)this.finished=await this.next();return this.currentScene.slides.setTarget(null),this.finished}async reset(){this.previousScene=null,this.currentScene=this.scenes.current[0],this.frame=0,await this.currentScene.reset()}reload(t){this.scenes.current.forEach((e=>e.reload(t)))}async recalculate(){this.previousScene=null,this.slides=[];const t=this.speed;this.frame=0,this.speed=1;const e=[];try{for(const t of this.scenes.current)await t.recalculate((t=>{this.frame=t})),this.slides.push(...t.slides.onChanged.current),e.push(t)}finally{this.speed=t}this.scenes.current=e,this.duration=this.frame}async next(){if(this.previousScene&&(await this.previousScene.next(),this.currentScene.isFinished()&&(this.previousScene=null)),this.frame+=this.speed,this.currentScene.isFinished())return!0;if(await this.currentScene.next(),this.previousScene&&this.currentScene.isAfterTransitionIn()&&(this.previousScene=null),this.currentScene.canTransitionOut()){this.previousScene=this.currentScene;const t=this.getNextScene(this.previousScene);t&&(this.currentScene=t,await this.currentScene.reset(this.previousScene)),t&&!this.currentScene.isAfterTransitionIn()||(this.previousScene=null)}return this.currentScene.isFinished()}findBestScene(t){let e=this.scenes.current[0];for(const s of this.scenes.current){if(!s.isCached()||s.lastFrame>t)return s;e=s}return e}getNextScene(t){const e=this.scenes.current;if(!t)return e[0];const s=e.findIndex((e=>e===t));return s<0?null:e[s+1]??null}}class H{get onDataChanged(){return this.data.subscribable}constructor(t){this.logger=t,this.data=new N(null),this.context=new AudioContext,this.audioElement=new Audio,this.source=null,this.error=!1,this.abortController=null,this.offset=0}getTime(){return this.toAbsoluteTime(this.audioElement.currentTime)}setTime(t){this.audioElement.currentTime=this.toRelativeTime(t)}setOffset(t){this.offset=t}setMuted(t){this.audioElement.muted=t}setSource(t){var e;this.source=t,this.audioElement.src=t,null==(e=this.abortController)||e.abort(),this.abortController=new AbortController,this.loadData(this.abortController.signal).catch((t=>{"AbortError"!==t.name&&this.logger.error(t)}))}isInRange(t){return t>=this.offset&&t<this.audioElement.duration}toRelativeTime(t){return Math.max(0,t-this.offset)}toAbsoluteTime(t){return t+this.offset}isReady(){return this.source&&!this.error}async setPaused(t){if(this.source&&this.audioElement.paused!==t)if(t)this.audioElement.pause();else try{return await this.audioElement.play(),this.error=!1,!0}catch(e){this.error||w().error(e),this.error=!0}return!1}async loadData(t){if(this.data.current=null,!this.source)return;const e=await fetch(this.source,{signal:t}),s=await e.arrayBuffer();if(t.aborted)return;const i=await this.decodeAudioData(s);if(t.aborted)return;const r=256,n=~~(i.length/r),a=[];let o=0;for(let h=0;h<i.numberOfChannels;h++){const t=i.getChannelData(h);for(let e=0;e<n;e++){const s=~~(e*r),i=~~(s+r);let n=t[s],c=n;for(let e=s;e<i;e++){const s=t[e];s>c&&(c=s),s<n&&(n=s)}(0===h||c>a[2*e])&&(a[2*e]=c),(0===h||n<a[2*e+1])&&(a[2*e+1]=n),c>o&&(o=c),Math.abs(n)>o&&(o=Math.abs(n))}}this.data.current={peaks:a,absoluteMax:o,length:n,sampleRate:i.sampleRate/r*2}}decodeAudioData(t){return new Promise(((e,s)=>this.context.decodeAudioData(t,e,s)))}}class G extends M{async dispatch(t){await Promise.all(this.notifySubscribers(t))}}class W extends M{dispatch(t){this.notifySubscribers(t)}}class V{constructor(t){this.playback=t}secondsToFrames(t){return Math.ceil(t*this.playback.fps)}framesToSeconds(t){return t/this.playback.fps}get time(){return this.framesToSeconds(this.playback.frame)}get frame(){return this.playback.frame}get speed(){return this.playback.speed}get fps(){return this.playback.fps}get state(){return this.playback.state}}class J{constructor(){this.resolveCurrent=null,this.current=null}async acquire(){for(;this.current;)await this.current;this.current=new Promise((t=>{this.resolveCurrent=t}))}release(){var t;this.current=null,null==(t=this.resolveCurrent)||t.call(this),this.resolveCurrent=null}}class Q{get onChanged(){return this.events.subscribable}constructor(t){this.scene=t,this.events=new N([]),this.registeredEvents={},this.lookup={},this.collisionLookup=new Set,this.previousReference=[],this.didEventsChange=!1,this.preserveTiming=!0,this.handleReload=()=>{this.registeredEvents={},this.collisionLookup.clear()},this.handleRecalculated=()=>{var t;this.preserveTiming=!0,this.events.current=Object.values(this.registeredEvents),(this.didEventsChange||((null==(t=this.previousReference)?void 0:t.length)??0)!==this.events.current.length)&&(this.didEventsChange=!1,this.previousReference=Object.values(this.registeredEvents).map((t=>({name:t.name,targetTime:t.targetTime}))),this.scene.meta.timeEvents.set(this.previousReference))},this.handleReset=()=>{this.collisionLookup.clear()},this.handleMetaChanged=t=>{t!==this.previousReference&&(this.previousReference=t,this.load(t),this.scene.reload())},this.previousReference=t.meta.timeEvents.get(),this.load(this.previousReference),t.onReloaded.subscribe(this.handleReload),t.onRecalculated.subscribe(this.handleRecalculated),t.onReset.subscribe(this.handleReset),t.meta.timeEvents.onChanged.subscribe(this.handleMetaChanged,!1)}set(t,e,s){void 0===s&&(s=!0),this.lookup[t]&&this.lookup[t].offset!==e&&(this.preserveTiming=s,this.lookup[t]={...this.lookup[t],targetTime:this.lookup[t].initialTime+e,offset:e},this.registeredEvents[t]=this.lookup[t],this.events.current=Object.values(this.registeredEvents),this.didEventsChange=!0,this.scene.reload())}register(t,e){if(this.collisionLookup.has(t))return this.scene.logger.error({message:`name "${t}" has already been used for another event name.`,stack:(new Error).stack}),0;if(this.collisionLookup.add(t),this.lookup[t]){let s=!1;const i={...this.lookup[t]},r=(new Error).stack;i.stack!==r&&(i.stack=r,s=!0),i.initialTime!==e&&(i.initialTime=e,s=!0);const n=Math.max(0,i.targetTime-i.initialTime);this.preserveTiming&&i.offset!==n&&(i.offset=n,s=!0);const a=i.initialTime+i.offset;this.preserveTiming||i.targetTime===a||(this.didEventsChange=!0,i.targetTime=a,s=!0),s&&(this.lookup[t]=i)}else this.didEventsChange=!0,this.lookup[t]={name:t,initialTime:e,targetTime:e,offset:0,stack:(new Error).stack};return this.registeredEvents[t]=this.lookup[t],this.lookup[t].offset}load(t){for(const e of t){const t=this.lookup[e.name]??{name:e.name,initialTime:0,offset:0};this.lookup[e.name]={...t,targetTime:e.targetTime}}}}class Y{get onRender(){return this.render.subscribable}get onStateChanged(){return this.playerState.subscribable}get onFrameChanged(){return this.frame.subscribable}get onDurationChanged(){return this.duration.subscribable}get onRecalculated(){return this.recalculated.subscribable}get startFrame(){return Math.min(this.playback.duration,this.status.secondsToFrames(this.startTime))}get endFrame(){return Math.min(this.playback.duration,this.status.secondsToFrames(this.endTime))}get finished(){return this.playback.finished||this.playback.frame>=this.endFrame}constructor(t,e,s,i){var r,n;void 0===e&&(e={}),void 0===s&&(s={}),void 0===i&&(i=-1),this.project=t,this.settings=e,this.initialState=s,this.initialFrame=i,this.render=new G,this.frame=new N(0),this.duration=new N(0),this.recalculated=new W,this.lock=new J,this.startTime=0,this.endTime=1/0,this.requestId=null,this.renderTime=0,this.requestedSeek=-1,this.requestedRecalculation=!0,this.active=!1,this.playerState=new N({loop:!0,muted:!0,speed:1,...s,paused:!0}),this.requestedSeek=i,this.logger=this.project.logger,this.playback=new Z,this.status=new V(this.playback),this.audio=new H(this.logger),this.size=e.size??new z(1920,1080),this.resolutionScale=e.resolutionScale??1,this.startTime=(null==(r=e.range)?void 0:r[0])??0,this.endTime=(null==(n=e.range)?void 0:n[1])??1/0,this.playback.fps=e.fps??60,this.audio.setOffset(e.audioOffset??0),t.audio&&this.audio.setSource(t.audio);const a=[];for(const h of t.scenes){var o;const e=new h.klass({...h,playback:this.status,logger:this.project.logger,size:this.size,resolutionScale:this.resolutionScale,timeEventsClass:Q});null==(o=h.onReplaced)||o.subscribe((t=>{e.reload(t)}),!1),e.onReloaded.subscribe((()=>this.requestRecalculation())),e.variables.updateSignals(t.variables??{}),a.push(e)}this.playback.setup(a),this.activate()}async configure(t){await this.lock.acquire();let e=this.playback.frame,s=!1;if(this.startTime=t.range[0],this.endTime=t.range[1],this.playback.fps!==t.fps){const i=t.fps/this.playback.fps;this.playback.fps=t.fps,e=Math.floor(e*i),s=!0}t.size.exactlyEquals(this.size)&&t.resolutionScale===this.resolutionScale||(this.size=t.size,this.resolutionScale=t.resolutionScale,this.playback.reload({size:this.size,resolutionScale:this.resolutionScale})),void 0!==t.audioOffset&&this.audio.setOffset(t.audioOffset),this.lock.release(),s&&(this.playback.reload(),this.frame.current=e,this.requestRecalculation(),this.requestedSeek=e)}requestSeek(t){this.requestedSeek=this.clampRange(t)}requestPreviousFrame(){this.requestedSeek=this.frame.current-this.playback.speed}requestNextFrame(){this.requestedSeek=this.frame.current+this.playback.speed}requestReset(){this.requestedSeek=0}toggleLoop(t){void 0===t&&(t=!this.playerState.current.loop),t!==this.playerState.current.loop&&(this.playerState.current={...this.playerState.current,loop:t})}togglePlayback(t){void 0===t&&(t=this.playerState.current.paused),t===this.playerState.current.paused&&(this.playerState.current={...this.playerState.current,paused:!t},t&&!this.playerState.current.loop&&this.playback.frame===this.playback.duration&&this.requestReset())}toggleAudio(t){void 0===t&&(t=this.playerState.current.muted),t===this.playerState.current.muted&&(this.playerState.current={...this.playerState.current,muted:!t})}setSpeed(t){t!==this.playerState.current.speed&&(this.playback.speed=t,this.playback.reload(),this.playerState.current={...this.playerState.current,speed:t},this.requestRecalculation())}setVariables(t){for(const e of this.playback.onScenesRecalculated.current)e.variables.updateSignals(t)}activate(){this.active=!0,this.request()}deactivate(){this.active=!1,null!==this.requestId&&(cancelAnimationFrame(this.requestId),this.requestId=null)}requestRecalculation(){this.requestedRecalculation=!0,this.request()}async prepare(){const t={...this.playerState.current,seek:this.requestedSeek};if(this.requestedSeek=-1,this.requestedRecalculation){t.seek<0&&(t.seek=this.playback.frame);try{await this.playback.recalculate(),this.duration.current=this.playback.frame,this.recalculated.dispatch()}catch(s){throw this.requestSeek(t.seek),s}finally{this.requestedRecalculation=!1}}(!t.loop&&this.finished&&!t.paused&&t.seek<0||this.endFrame===this.startFrame)&&(this.togglePlayback(!1),t.paused=!0),t.loop&&(t.seek>this.endFrame||this.finished&&!t.paused)&&this.startFrame!==this.endTime&&(t.seek=this.startFrame);const e=t.paused||this.finished||!this.audio.isInRange(this.status.time);return await this.audio.setPaused(e)&&this.syncAudio(-3),this.audio.setMuted(t.muted),t}async run(){const t=await this.prepare(),e=this.playback.state;if(this.playback.state=t.paused?F.Paused:F.Playing,t.seek>=0||!this.isInRange(this.status.frame)){const e=t.seek<0?this.status.frame:t.seek,s=this.clampRange(e);this.logger.profile("seek time"),await this.playback.seek(s),this.logger.profile("seek time"),this.syncAudio(-3)}else{if(t.paused||1===t.speed&&this.audio.isReady()&&this.audio.isInRange(this.status.time)&&this.audio.getTime()<this.status.time)return t.paused&&e!==F.Paused&&await this.render.dispatch(),!t.paused&&this.status.time>this.audio.getTime()+.02&&this.syncAudio(),void this.request();if(this.audio.isReady()&&1===t.speed&&this.audio.isInRange(this.status.time)&&this.status.framesToSeconds(this.playback.frame+1)<this.audio.getTime()-.02){const t=this.status.secondsToFrames(this.audio.getTime());await this.playback.seek(t)}else this.status.frame<this.endFrame&&(await this.playback.progress(),1!==t.speed&&this.syncAudio())}!t.paused&&this.playback.currentScene.slides.isWaiting()&&(this.togglePlayback(!1),t.paused=!0),await this.render.dispatch(),this.frame.current=this.playback.frame,this.request()}request(){this.active&&(this.requestId??(this.requestId=requestAnimationFrame((async t=>{if(this.requestId=null,t-this.renderTime>=1e3/(this.status.fps+5)){this.renderTime=t,await this.lock.acquire();try{await this.run()}catch(e){this.logger.error(e)}this.lock.release()}else this.request()}))))}clampRange(t){return n(this.startFrame,this.endFrame,t)}isInRange(t){return t>=this.startFrame&&t<=this.endFrame}syncAudio(t){void 0===t&&(t=0),this.audio.setTime(this.status.framesToSeconds(this.playback.frame+t))}}var $=Object.defineProperty,_=(t,e,s)=>(((t,e,s)=>{e in t?$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s})(t,"symbol"!=typeof e?e+"":e,s),s);const U=[];class X extends Error{constructor(t,e){super(t),this.remarks=e}}const K=[];function tt(){const t=K.at(-1);if(!t)throw new X("The thread is not available in the current context.","<p><code>useThread()</code> can only be called from within generator functions.\n      It&#39;s not available during rendering.</p>\n");return t}function et(t){return{message:t.message,stack:t.stack,remarks:t.remarks}}const st=180/Math.PI,it=Math.PI/180,rt=[];function nt(t){const e={[t.name]:t},s=Object.getOwnPropertyDescriptor(e,t.name);for(var i=arguments.length,r=new Array(i>1?i-1:0),n=1;n<i;n++)r[n-1]=arguments[n];if(s)for(let a=r.length-1;a>=0;a--)r[a](e,t.name,s)}function at(t){return function(e,s,i){i.value.prototype.name=t??s,i.value.prototype.threadable=!0}}function ot(t,e){const s=Object.getPrototypeOf(t);s.threadable||(s.threadable=!0,s.name="string"==typeof e?e:function(t){return Object.getPrototypeOf(t).name??null}(e))}class ht{constructor(){this.subscribable=new ct(this),this.subscribers=new Set}subscribe(t){return this.subscribers.add(t),()=>this.unsubscribe(t)}unsubscribe(t){this.subscribers.delete(t)}clear(){this.subscribers.clear()}notifySubscribers(t){return[...this.subscribers].map((e=>e(t)))}}class ct{constructor(t){this.dispatcher=t}subscribe(t){return this.dispatcher.subscribe(t)}unsubscribe(t){this.dispatcher.unsubscribe(t)}}class lt extends ht{constructor(){super(...arguments),this.value=!1}raise(){this.value||(this.value=!0,this.notifySubscribers())}reset(){this.value=!1}isRaised(){return this.value}subscribe(t){const e=super.subscribe(t);return this.value&&t(),e}}function ut(t){const e=function(){const t=U.at(-1);if(!t)throw new Error("The scene is not available in the current context.");return t}(),s=tt();return e.timeEvents.register(t,s.time())}function dt(t,e,s){return t+(e-t)*s}function pt(t,e,s){return void 0===e&&(e=0),void 0===s&&(s=1),dt(e,s,t=t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2)}function*ft(t,e,s){const i=tt(),r=i.time(),n=i.time()+t;for(e(0,0);n>i.fixed;){const s=i.fixed-r;s>0&&e(s/t,s),yield}i.time(n),e(1,t),null==s||s(1,t)}function*yt(t,e){void 0===t&&(t=0);const s=tt(),i=function(){const t=rt.at(-1);if(!t)throw new Error("The playback is not available in the current context.");return t}().framesToSeconds(1),r=s.time()+t;for(;r-i>s.fixed;)yield;s.time(r),e&&(yield*e)}function gt(t,e){let s;return"string"==typeof t?(s=e(),ot(s,t)):(s=t(),ot(s,s)),s}nt(ft,at()),nt((function*(t,e){yield*yt(ut(t)),e&&(yield*e)}),at()),nt(yt,at());class mt{static collectPromise(t,e){void 0===e&&(e=null);const s={promise:t,value:e,stack:(new Error).stack},i=this.collectionStack.at(-1);return i&&(s.owner=i.owner),t.then((t=>{s.value=t,null==i||i.markDirty()})),this.promises.push(s),s}static hasPromises(){return this.promises.length>0}static async consumePromises(){const t=[...this.promises];return await Promise.all(t.map((t=>t.promise))),this.promises=this.promises.filter((e=>!t.includes(e))),t}constructor(t){this.owner=t,this.dependencies=new Set,this.event=new lt,this.markDirty=()=>this.event.raise(),this.invokable=this.invoke.bind(this),Object.defineProperty(this.invokable,"context",{value:this}),Object.defineProperty(this.invokable,"toPromise",{value:this.toPromise.bind(this)})}invoke(){}startCollecting(){if(mt.collectionSet.has(this))throw new X("A circular dependency occurred between signals.","This can happen when signals reference each other in a loop.\n        Try using the attached stack trace to locate said loop.");mt.collectionSet.add(this),mt.collectionStack.push(this)}finishCollecting(){if(mt.collectionSet.delete(this),mt.collectionStack.pop()!==this)throw new Error("collectStart/collectEnd was called out of order.")}clearDependencies(){this.dependencies.forEach((t=>t.unsubscribe(this.markDirty))),this.dependencies.clear()}collect(){const t=mt.collectionStack.at(-1);t&&(t.dependencies.add(this.event.subscribable),this.event.subscribe(t.markDirty))}dispose(){this.clearDependencies(),this.event.clear(),this.owner=null}async toPromise(){do{await mt.consumePromises(),this.invokable()}while(mt.hasPromises());return this.invokable}}function vt(t){return"function"==typeof t}function bt(t,e){return vt(t)?()=>e(t()):e(t)}mt.collectionSet=new Set,mt.collectionStack=[],mt.promises=[];const wt=Symbol.for("@motion-canvas/core/signals/default");class St extends mt{constructor(t,e,s,i,r){void 0===s&&(s=void 0),void 0===i&&(i=t=>t),void 0===r&&(r={}),super(s),this.initial=t,this.interpolation=e,this.parser=i,Object.defineProperty(this.invokable,"reset",{value:this.reset.bind(this)}),Object.defineProperty(this.invokable,"save",{value:this.save.bind(this)}),Object.defineProperty(this.invokable,"isInitial",{value:this.isInitial.bind(this)}),void 0!==this.initial&&(this.current=this.initial,this.markDirty(),vt(this.initial)||(this.last=this.parse(this.initial))),this.extensions={getter:this.getter.bind(this),setter:this.setter.bind(this),tweener:this.tweener.bind(this),...r}}toSignal(){return this.invokable}parse(t){return this.parser(t)}set(t){return this.extensions.setter(t),this.owner}setter(t){return t===wt&&(t=this.initial),this.current===t||(this.current=t,this.markDirty(),this.clearDependencies(),vt(t)||(this.last=this.parse(t))),this.owner}get(){return this.extensions.getter()}getter(){var t;if(this.event.isRaised()&&vt(this.current)){this.clearDependencies(),this.startCollecting();try{this.last=this.parse(this.current())}catch(e){(function(){var t;return(null==(t=U.at(-1))?void 0:t.logger)??console})().error({...et(e),inspect:null==(t=this.owner)?void 0:t.key})}this.finishCollecting()}return this.event.reset(),this.collect(),this.last}invoke(t,e,s,i){return void 0===s&&(s=pt),void 0===i&&(i=this.interpolation),void 0===t?this.get():void 0===e?this.set(t):this.createQueue(s,i).to(t,e)}createQueue(t,e){var s=this;const i=this.get(),r=[],n=gt("animation chain",(function*(){for(;r.length>0;)yield*r.shift()}));return n.to=function(i,a,o,h){return void 0===o&&(o=t),void 0===h&&(h=e),t=o,e=h,r.push(s.tween(i,a,o,h)),n},n.back=function(a,o,h){return void 0===o&&(o=t),void 0===h&&(h=e),t=o,e=h,r.push(s.tween(i,a,t,e)),n},n.wait=t=>(r.push(yt(t)),n),n.run=t=>(r.push(t),n),n.do=t=>(r.push(gt((function*(){t()}))),n),n}*tween(t,e,s,i){t===wt&&(t=this.initial),yield*this.extensions.tweener(t,e,s,i),this.set(t)}*tweener(t,e,s,i){const r=this.get();yield*ft(e,(e=>{this.set(i(r,this.parse(function(t){return vt(t)?t():t}(t)),s(e)))}))}dispose(){super.dispose(),this.initial=void 0,this.current=void 0,this.last=void 0}reset(){return void 0!==this.initial&&this.set(this.initial),this.owner}save(){return this.set(this.get())}isInitial(){return this.collect(),this.current===this.initial}raw(){return this.current}}class kt extends St{constructor(t,e,s,i,r,n){var a;void 0===r&&(r=void 0),void 0===n&&(n={}),super(void 0,i,r,e,n),this.entries=t,this.signals=[],this.parser=e;for(const o of t){let t,i;Array.isArray(o)?([t,i]=o,(a=i.context).owner??(a.owner=this)):(t=o,i=new St(bt(s,(t=>e(t)[o])),dt,r??this.invokable).toSignal()),this.signals.push([t,i]),Object.defineProperty(this.invokable,t,{value:i})}}toSignal(){return this.invokable}parse(t){return this.parser(t)}getter(){return this.parse(Object.fromEntries(this.signals.map((t=>{let[e,s]=t;return[e,s()]}))))}setter(t){if(vt(t))for(const[e,s]of this.signals)s((()=>this.parser(t())[e]));else{const e=this.parse(t);for(const[t,s]of this.signals)s(e[t])}return this.owner}reset(){for(const[,t]of this.signals)t.reset();return this.owner}save(){for(const[,t]of this.signals)t.save();return this.owner}}var xt,Tt,Mt;!function(t){t[t.Vertical=1]="Vertical",t[t.Horizontal=2]="Horizontal"}(xt||(xt={})),function(t){t[t.Top=4]="Top",t[t.Bottom=8]="Bottom",t[t.Left=16]="Left",t[t.Right=32]="Right"}(Tt||(Tt={})),function(t){t[t.Middle=3]="Middle",t[t.Top=5]="Top",t[t.Bottom=9]="Bottom",t[t.Left=18]="Left",t[t.Right=34]="Right",t[t.TopLeft=20]="TopLeft",t[t.TopRight=36]="TopRight",t[t.BottomLeft=24]="BottomLeft",t[t.BottomRight=40]="BottomRight"}(Mt||(Mt={}));class Ct{static createSignal(t,e,s){return void 0===e&&(e=Ct.lerp),new kt(["x","y"],(t=>new Ct(t)),t,e,s).toSignal()}static lerp(t,e,s){let i,r;return"number"==typeof s?i=r=s:(i=s.x,r=s.y),new Ct(dt(t.x,e.x,i),dt(t.y,e.y,r))}static arcLerp(t,e,s,i,r){return void 0===i&&(i=!1),r??(r=t.sub(e).ctg),Ct.lerp(t,e,function(t,e,s){let i=e;s>1?s=1/s:i=!i;const r=i?Math.acos(function(t,e,s){return s<t?t:s>e?e:s}(-1,1,1-t)):Math.asin(t),n=dt(r,dt(0,Math.PI/2,t),s);let a=Math.sin(n),o=1-Math.cos(n);return e&&([a,o]=[o,a]),new Ct(a,o)}(s,i,r))}static createArcLerp(t,e){return(s,i,r)=>Ct.arcLerp(s,i,r,t,e)}static fromOrigin(t){const e=new Ct;return t===Mt.Middle||(t&Tt.Left?e.x=-1:t&Tt.Right&&(e.x=1),t&Tt.Top?e.y=-1:t&Tt.Bottom&&(e.y=1)),e}static fromScalar(t){return new Ct(t,t)}static fromRadians(t){return new Ct(Math.cos(t),Math.sin(t))}static fromDegrees(t){return Ct.fromRadians(t*it)}static radians(t,e){return Math.atan2(e,t)}static degrees(t,e){return Ct.radians(t,e)*st}static magnitude(t,e){return Math.sqrt(t*t+e*e)}static squaredMagnitude(t,e){return t*t+e*e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}get magnitude(){return Ct.magnitude(this.x,this.y)}get squaredMagnitude(){return Ct.squaredMagnitude(this.x,this.y)}get normalized(){return this.scale(1/Ct.magnitude(this.x,this.y))}get safe(){return new Ct(isNaN(this.x)?0:this.x,isNaN(this.y)?0:this.y)}get flipped(){return new Ct(-this.x,-this.y)}get floored(){return new Ct(Math.floor(this.x),Math.floor(this.y))}get perpendicular(){return new Ct(this.y,-this.x)}get radians(){return Ct.radians(this.x,this.y)}get degrees(){return Ct.degrees(this.x,this.y)}get ctg(){return this.x/this.y}constructor(t,e){if(this.x=0,this.y=0,null!=t){if("object"!=typeof t)return this.x=t,void(this.y=e??t);if(Array.isArray(t))return this.x=t[0],void(this.y=t[1]);if("width"in t)return this.x=t.width,void(this.y=t.height);this.x=t.x,this.y=t.y}}lerp(t,e){return Ct.lerp(this,t,e)}getOriginOffset(t){const e=Ct.fromOrigin(t);return e.x*=this.x/2,e.y*=this.y/2,e}scale(t){return new Ct(this.x*t,this.y*t)}transformAsPoint(t){return new Ct(this.x*t.m11+this.y*t.m21+t.m41,this.x*t.m12+this.y*t.m22+t.m42)}transform(t){return new Ct(this.x*t.m11+this.y*t.m21,this.x*t.m12+this.y*t.m22)}mul(t){const e=new Ct(t);return new Ct(this.x*e.x,this.y*e.y)}div(t){const e=new Ct(t);return new Ct(this.x/e.x,this.y/e.y)}add(t){const e=new Ct(t);return new Ct(this.x+e.x,this.y+e.y)}sub(t){const e=new Ct(t);return new Ct(this.x-e.x,this.y-e.y)}dot(t){const e=new Ct(t);return this.x*e.x+this.y*e.y}mod(t){const e=new Ct(t);return new Ct(this.x%e.x,this.y%e.y)}addX(t){return new Ct(this.x+t,this.y)}addY(t){return new Ct(this.x,this.y+t)}toSymbol(){return Ct.symbol}toString(){return`Vector2(${this.x}, ${this.y})`}serialize(){return{x:this.x,y:this.y}}exactlyEquals(t){return this.x===t.x&&this.y===t.y}equals(t,e){return void 0===e&&(e=1e-6),Math.abs(this.x-t.x)<=e+Number.EPSILON&&Math.abs(this.y-t.y)<=e+Number.EPSILON}}Ct.symbol=Symbol.for("@motion-canvas/core/types/Vector2"),Ct.zero=new Ct,Ct.one=new Ct(1,1),Ct.right=new Ct(1,0),Ct.left=new Ct(-1,0),Ct.up=new Ct(0,1),Ct.down=new Ct(0,-1);const It="motion-canvas-player";class Pt extends HTMLElement{constructor(){super(),_(this,"root"),_(this,"canvas"),_(this,"overlay"),_(this,"button"),_(this,"state","initial"),_(this,"project",null),_(this,"player",null),_(this,"defaultSettings"),_(this,"abortController",null),_(this,"mouseMoveId",null),_(this,"finished",!1),_(this,"playing",!1),_(this,"connected",!1),_(this,"stage",new j),_(this,"handleMouseMove",(()=>{this.mouseMoveId&&clearTimeout(this.mouseMoveId),this.hover&&!this.playing&&this.setPlaying(!0),this.mouseMoveId=window.setTimeout((()=>{this.mouseMoveId=null,this.updateClass()}),2e3),this.updateClass()})),_(this,"handleMouseLeave",(()=>{this.hover&&this.setPlaying(!1),this.mouseMoveId&&(clearTimeout(this.mouseMoveId),this.mouseMoveId=null,this.updateClass())})),_(this,"handleMouseDown",(t=>{t.preventDefault()})),_(this,"handleClick",(()=>{this.auto||(this.handleMouseMove(),this.setPlaying(!this.playing),this.button.animate([{scale:"0.9"},{scale:"1",easing:"ease-out"}],{duration:200}))})),_(this,"render",(async()=>{this.player&&await this.stage.render(this.player.playback.currentScene,this.player.playback.previousScene)})),this.root=this.attachShadow({mode:"open"}),this.root.innerHTML='<style>.initial{display:none}.state-initial .initial{display:block}.loading{display:none}.state-loading .loading{display:block}.ready{display:none}.state-ready .ready{display:block}.error{display:none}.state-error .error{display:block}:host{position:relative;display:block}.overlay{position:absolute;left:0;right:0;top:0;bottom:0;display:flex;align-items:center;justify-content:center;opacity:0;background-color:#0000008a;transition:opacity .1s}.overlay.state-ready:not(.auto){cursor:pointer}.overlay.playing:not(.hover):hover{cursor:none}.overlay.hover,.overlay.state-ready:focus-within,.overlay.state-ready:not(.playing){opacity:1}.overlay.hover .button,.overlay.state-ready:focus-within .button,.overlay.state-ready:not(.playing) .button{scale:1;transition:scale .1s ease-out}.overlay.state-loading,.overlay.state-error{opacity:1;transition:opacity 1s}.overlay.state-ready.auto{opacity:0}.button{width:50%;max-width:96px;aspect-ratio:1;scale:.5;transition:scale .1s ease-in,opacity .1s;background-color:transparent;border:none;background-size:100% 100%;background-repeat:no-repeat;opacity:.54;cursor:inherit;background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjRweCIgdmlld0JveD0iMCAwIDI0IDI0IiB3aWR0aD0iMjRweCIgZmlsbD0iI2ZmZmZmZiI+PHBhdGggZD0iTTAgMGgyNHYyNEgwVjB6IiBmaWxsPSJub25lIi8+PHBhdGggZD0iTTEyIDJDNi40OCAyIDIgNi40OCAyIDEyczQuNDggMTAgMTAgMTAgMTAtNC40OCAxMC0xMFMxNy41MiAyIDEyIDJ6bS0yIDE0LjV2LTlsNiA0LjUtNiA0LjV6Ii8+PC9zdmc+)}.playing .button{background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDI0IDI0IiBoZWlnaHQ9IjI0cHgiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0cHgiIGZpbGw9IiNmZmZmZmYiPjxnPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iMjQiIHdpZHRoPSIyNCIvPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iMjQiIHdpZHRoPSIyNCIvPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iMjQiIHdpZHRoPSIyNCIvPjwvZz48Zz48Zy8+PHBhdGggZD0iTTEyLDJDNi40OCwyLDIsNi40OCwyLDEyczQuNDgsMTAsMTAsMTBzMTAtNC40OCwxMC0xMFMxNy41MiwyLDEyLDJ6IE0xMSwxNkg5VjhoMlYxNnogTTE1LDE2aC0yVjhoMlYxNnoiLz48L2c+PC9zdmc+)}.button:focus,.overlay:hover .button{opacity:.87}.auto .button{display:none}.canvas{width:100%;display:block;opacity:0;transition:opacity .1s}.canvas.state-ready{opacity:1}.message{font-family:JetBrains Mono,sans-serif;text-align:center;font-size:20px;padding:8px 16px;margin:16px;border-radius:4px;color:#fff9;background-color:#000000de}.loader{width:50%;max-width:96px;display:none;rotate:-90deg;animation:stroke 2s cubic-bezier(.5,0,.5,1) infinite,rotate 2s linear infinite}@keyframes stroke{0%{stroke-dasharray:5.6548667765px 50.8938009883px;stroke-dashoffset:2.8274333882px}50%{stroke-dasharray:50.8938009883px 5.6548667765px;stroke-dashoffset:-2.8274333882px}to{stroke-dasharray:5.6548667765px 50.8938009883px;stroke-dashoffset:-53.7212343766px}}@keyframes rotate{0%{rotate:-110deg}to{rotate:250deg}}\n</style><div class="overlay">\n  <button title="Play / Pause" class="button ready" tabindex="0"></button>\n  <div class="message error">\n    An error occurred while loading the animation.\n  </div>\n  <svg\n    class="loader loading"\n    viewBox="0 0 24 24"\n    stroke="#ffffff"\n    stroke-width="2"\n    fill="transparent"\n  >\n    <circle cx="12" cy="12" r="9" />\n  </svg>\n</div>\n',this.overlay=this.root.querySelector(".overlay"),this.button=this.root.querySelector(".button"),this.canvas=this.stage.finalBuffer,this.canvas.classList.add("canvas"),this.root.prepend(this.canvas),this.overlay.addEventListener("click",this.handleClick),this.overlay.addEventListener("mousemove",this.handleMouseMove),this.overlay.addEventListener("mouseleave",this.handleMouseLeave),this.button.addEventListener("mousedown",this.handleMouseDown),this.setState("initial")}static get observedAttributes(){return["src","quality","width","height","auto","variables"]}get auto(){return!!this.getAttribute("auto")}get hover(){return"hover"===this.getAttribute("auto")}get quality(){const t=this.getAttribute("quality");return t?parseFloat(t):this.defaultSettings.resolutionScale}get width(){const t=this.getAttribute("width");return t?parseFloat(t):this.defaultSettings.size.width}get height(){const t=this.getAttribute("height");return t?parseFloat(t):this.defaultSettings.size.height}get variables(){try{const t=this.getAttribute("variables");return t?JSON.parse(t):{}}catch{return this.project.logger.warn("Project variables could not be parsed."),{}}}setState(t){this.state=t,this.setPlaying(this.playing)}setPlaying(t){var e,s;"ready"===this.state&&(t||this.auto&&!this.hover)?(null==(e=this.player)||e.togglePlayback(!0),this.playing=!0):(null==(s=this.player)||s.togglePlayback(!1),this.playing=!1),this.updateClass()}updateClass(){this.overlay.className=`overlay state-${this.state}`,this.canvas.className=`canvas state-${this.state}`,this.overlay.classList.toggle("playing",this.playing),this.overlay.classList.toggle("auto",this.auto),this.overlay.classList.toggle("hover",null!==this.mouseMoveId),this.connected&&(null===this.mouseMoveId&&this.playing?delete this.dataset.overlay:this.dataset.overlay="")}async updateSource(t){var e,s,i,r;let n;this.setState("initial"),null==(e=this.abortController)||e.abort(),this.abortController=new AbortController;try{const e=import(t),s=new Promise((t=>setTimeout(t,200)));await Promise.any([s,e]),this.setState("loading"),n=(await e).default}catch(o){return console.error(o),void this.setState("error")}this.defaultSettings=n.meta.getFullRenderingSettings();const a=new Y(n);a.setVariables(this.variables),this.finished=!1,null==(s=this.player)||s.onRender.unsubscribe(this.render),null==(i=this.player)||i.togglePlayback(!1),null==(r=this.player)||r.deactivate(),this.project=n,this.player=a,this.updateSettings(),this.player.onRender.subscribe(this.render),this.player.togglePlayback(this.playing),this.setState("ready")}attributeChangedCallback(t,e,s){var i;switch(t){case"auto":this.setPlaying(this.playing);break;case"src":this.updateSource(s);break;case"quality":case"width":case"height":this.updateSettings();break;case"variables":null==(i=this.player)||i.setVariables(this.variables)}}disconnectedCallback(){var t,e;this.connected=!1,null==(t=this.player)||t.deactivate(),null==(e=this.player)||e.onRender.unsubscribe(this.render)}connectedCallback(){var t,e;this.connected=!0,null==(t=this.player)||t.activate(),null==(e=this.player)||e.onRender.subscribe(this.render)}updateSettings(){const t={...this.defaultSettings,size:new Ct(this.width,this.height),resolutionScale:this.quality};this.stage.configure(t),this.player.configure(t)}}customElements.get(It)||customElements.define(It,Pt)}}]);