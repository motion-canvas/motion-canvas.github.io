"use strict";(self.webpackChunk_motion_canvas_docs=self.webpackChunk_motion_canvas_docs||[]).push([[7067],{7067:(e,t,s)=>{function i(e,t){void 0===t&&(t=document.createElement("canvas"));const s=t.getContext("2d",e);if(!s)throw new Error("Could not create a 2D context.");return s}function r(e,t,s){return e+(t-e)*s}function a(e,t,s){return s<e?e:s>t?t:s}var n,o,h;s.r(t),function(e){e[e.Vertical=1]="Vertical",e[e.Horizontal=2]="Horizontal"}(n||(n={})),function(e){e[e.Top=4]="Top",e[e.Bottom=8]="Bottom",e[e.Left=16]="Left",e[e.Right=32]="Right"}(o||(o={})),function(e){e[e.Middle=3]="Middle",e[e.Top=5]="Top",e[e.Bottom=9]="Bottom",e[e.Left=18]="Left",e[e.Right=34]="Right",e[e.TopLeft=20]="TopLeft",e[e.TopRight=36]="TopRight",e[e.BottomLeft=24]="BottomLeft",e[e.BottomRight=40]="BottomRight"}(h||(h={}));const l=1e-6;function u(e,t,s){return void 0===t&&(t=0),void 0===s&&(s=1),r(t,s,e=e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2)}function c(e,t){return void 0===e&&(e=7.5625),void 0===t&&(t=2.75),function(s,i,a){return void 0===i&&(i=0),void 0===a&&(a=1),s<1/t?s*=e*s:s=s<2/t?e*(s-=1.505/t)*s+.75:s<2.5/t?e*(s-=2.25/t)*s+.9375:e*(s-=2.625/t)*s+.984375,r(i,a,s)}}void 0===d&&(d=1.70158);var d;(function(e){void 0===e&&(e=1.70158)})(),function(e,t){void 0===e&&(e=1.70158),void 0===t&&(t=1.525)}(),function(e,t){void 0===e&&(e=7.5625),void 0===t&&(t=2.75);const s=c(e,t)}(),c(),function(e,t){void 0===e&&(e=7.5625),void 0===t&&(t=2.75);const s=c(e,t)}(),function(e){void 0===e&&(e=2.094395)}(),function(e){void 0===e&&(e=2.094395)}(),function(e){void 0===e&&(e=1.39626)}();function v(e){const t={[e.name]:e},s=Object.getOwnPropertyDescriptor(t,e.name);if(s){for(var i=arguments.length,r=new Array(i>1?i-1:0),a=1;a<i;a++)r[a-1]=arguments[a];for(let i=r.length-1;i>=0;i--)r[i](t,e.name,s)}}function p(e){return function(t,s,i){i.value.prototype.name=e??s,i.value.prototype.threadable=!0}}class y extends Error{constructor(e,t){super(e),this.remarks=t}}const f=[];function g(){const e=f.at(-1);if(!e)throw new y("The thread is not available in the current context.","<p><code>useThread()</code> can only be called from within generator functions.\n      It&#39;s not available during rendering.</p>\n");return e}function*m(e,t,s){const i=g(),r=i.time(),a=i.time()+e;for(t(0,0);a>i.fixed;){const s=i.fixed-r;s>0&&t(s/e,s),yield}i.time(a),t(1,e),null==s||s(1,e)}v(m,p());const b=[];function w(){const e=b.at(-1);if(!e)throw new Error("The scene is not available in the current context.");return e}function x(){var e;return(null==(e=b.at(-1))?void 0:e.logger)??console}function S(e,t){const s=Object.getPrototypeOf(e);s.threadable||(s.threadable=!0,s.name="string"==typeof t?t:function(e){return Object.getPrototypeOf(e).name??null}(t))}function k(e,t){let s;return"string"==typeof e?(s=t(),S(s,e)):(s=e(),S(s,s)),s}const M=[];function*T(e,t){void 0===e&&(e=0);const s=g(),i=function(){const e=M.at(-1);if(!e)throw new Error("The playback is not available in the current context.");return e}().framesToSeconds(1),r=s.time()+e;for(;r-i>s.fixed;)yield;s.time(r),t&&(yield*t)}v((function*(e,t){yield*T(function(e){const t=w(),s=g();return t.timeEvents.register(e,s.time())}(e)),t&&(yield*t)}),p()),v(T,p());class P{constructor(){this.subscribable=new I(this),this.subscribers=new Set}subscribe(e){return this.subscribers.add(e),()=>this.unsubscribe(e)}unsubscribe(e){this.subscribers.delete(e)}clear(){this.subscribers.clear()}notifySubscribers(e){return[...this.subscribers].map((t=>t(e)))}}class I{constructor(e){this.dispatcher=e}subscribe(e){return this.dispatcher.subscribe(e)}unsubscribe(e){this.dispatcher.unsubscribe(e)}}class C extends P{constructor(){super(...arguments),this.value=!1}raise(){this.value||(this.value=!0,this.notifySubscribers())}reset(){this.value=!1}isRaised(){return this.value}subscribe(e){const t=super.subscribe(e);return this.value&&e(),t}}class R{static collectPromise(e,t){void 0===t&&(t=null);const s={promise:e,value:t,stack:(new Error).stack},i=this.collectionStack.at(-1);return i&&(s.owner=i.owner),e.then((e=>{s.value=e,null==i||i.markDirty()})),this.promises.push(s),s}static hasPromises(){return this.promises.length>0}static async consumePromises(){const e=[...this.promises];return await Promise.all(e.map((e=>e.promise))),this.promises=this.promises.filter((t=>!e.includes(t))),e}constructor(e){this.owner=e,this.dependencies=new Set,this.event=new C,this.markDirty=()=>this.event.raise(),this.invokable=this.invoke.bind(this),Object.defineProperty(this.invokable,"context",{value:this}),Object.defineProperty(this.invokable,"toPromise",{value:this.toPromise.bind(this)})}invoke(){}startCollecting(){if(R.collectionSet.has(this))throw new y("A circular dependency occurred between signals.","This can happen when signals reference each other in a loop.\n        Try using the attached stack trace to locate said loop.");R.collectionSet.add(this),R.collectionStack.push(this)}finishCollecting(){if(R.collectionSet.delete(this),R.collectionStack.pop()!==this)throw new Error("collectStart/collectEnd was called out of order.")}clearDependencies(){this.dependencies.forEach((e=>e.unsubscribe(this.markDirty))),this.dependencies.clear()}collect(){const e=R.collectionStack.at(-1);e&&(e.dependencies.add(this.event.subscribable),this.event.subscribe(e.markDirty))}dispose(){this.clearDependencies(),this.event.clear(),this.owner=null}async toPromise(){do{await R.consumePromises(),this.invokable()}while(R.hasPromises());return this.invokable}}function E(e){return"function"==typeof e}function L(e,t){return E(e)?()=>t(e()):t(e)}R.collectionSet=new Set,R.collectionStack=[],R.promises=[];const A=Symbol.for("@motion-canvas/core/signals/default");class N extends R{constructor(e,t,s,i,r){void 0===s&&(s=void 0),void 0===i&&(i=e=>e),void 0===r&&(r={}),super(s),this.initial=e,this.interpolation=t,this.parser=i,Object.defineProperty(this.invokable,"reset",{value:this.reset.bind(this)}),Object.defineProperty(this.invokable,"save",{value:this.save.bind(this)}),Object.defineProperty(this.invokable,"isInitial",{value:this.isInitial.bind(this)}),void 0!==this.initial&&(this.current=this.initial,this.markDirty(),E(this.initial)||(this.last=this.parse(this.initial))),this.extensions={getter:this.getter.bind(this),setter:this.setter.bind(this),tweener:this.tweener.bind(this),...r}}toSignal(){return this.invokable}parse(e){return this.parser(e)}set(e){return this.extensions.setter(e),this.owner}setter(e){return e===A&&(e=this.initial),this.current===e||(this.current=e,this.markDirty(),this.clearDependencies(),E(e)||(this.last=this.parse(e))),this.owner}get(){return this.extensions.getter()}getter(){if(this.event.isRaised()&&E(this.current)){this.clearDependencies(),this.startCollecting();try{this.last=this.parse(this.current())}catch(s){var e;x().error({...(t=s,{message:t.message,stack:t.stack,remarks:t.remarks}),inspect:null==(e=this.owner)?void 0:e.key})}this.finishCollecting()}var t;return this.event.reset(),this.collect(),this.last}invoke(e,t,s,i){if(void 0===s&&(s=u),void 0===i&&(i=this.interpolation),void 0===e)return this.get();if(void 0===t)return this.set(e);return this.createQueue(s,i).to(e,t)}createQueue(e,t){var s=this;const i=this.get(),r=[],a=k("animation chain",(function*(){for(;r.length>0;)yield*r.shift()}));return a.to=function(i,n,o,h){return void 0===o&&(o=e),void 0===h&&(h=t),e=o,t=h,r.push(s.tween(i,n,o,h)),a},a.back=function(n,o,h){return void 0===o&&(o=e),void 0===h&&(h=t),e=o,t=h,r.push(s.tween(i,n,e,t)),a},a.wait=e=>(r.push(T(e)),a),a.run=e=>(r.push(e),a),a.do=e=>(r.push(k((function*(){e()}))),a),a}*tween(e,t,s,i){e===A&&(e=this.initial),yield*this.extensions.tweener(e,t,s,i),this.set(e)}*tweener(e,t,s,i){const r=this.get();yield*m(t,(t=>{this.set(i(r,this.parse(function(e){return E(e)?e():e}(e)),s(t)))}))}dispose(){super.dispose(),this.initial=void 0,this.current=void 0,this.last=void 0}reset(){return void 0!==this.initial&&this.set(this.initial),this.owner}save(){return this.set(this.get())}isInitial(){return this.collect(),this.current===this.initial}raw(){return this.current}}class D extends N{constructor(e,t,s,i,a,n){var o;void 0===a&&(a=void 0),void 0===n&&(n={}),super(void 0,i,a,t,n),this.entries=e,this.signals=[],this.parser=t;for(const h of e){let e,i;Array.isArray(h)?([e,i]=h,(o=i.context).owner??(o.owner=this)):(e=h,i=new N(L(s,(e=>t(e)[h])),r,a??this.invokable).toSignal()),this.signals.push([e,i]),Object.defineProperty(this.invokable,e,{value:i})}}toSignal(){return this.invokable}parse(e){return this.parser(e)}getter(){return this.parse(Object.fromEntries(this.signals.map((e=>{let[t,s]=e;return[t,s()]}))))}setter(e){if(E(e))for(const[t,s]of this.signals)s((()=>this.parser(e())[t]));else{const t=this.parse(e);for(const[e,s]of this.signals)s(t[e])}return this.owner}reset(){for(const[,e]of this.signals)e.reset();return this.owner}save(){for(const[,e]of this.signals)e.save();return this.owner}}const z=180/Math.PI,O=Math.PI/180;class q{static fromRotation(e){return q.identity.rotate(e)}static fromTranslation(e){return q.identity.translate(new j(e))}static fromScaling(e){return q.identity.scale(new j(e))}get x(){return new j(this.values[0],this.values[1])}get y(){return new j(this.values[2],this.values[3])}get scaleX(){return this.values[0]}set scaleX(e){this.values[0]=this.x.normalized.scale(e).x}get skewX(){return this.values[1]}set skewX(e){this.values[1]=e}get scaleY(){return this.values[3]}set scaleY(e){this.values[3]=this.y.normalized.scale(e).y}get skewY(){return this.values[2]}set skewY(e){this.values[2]=e}get translateX(){return this.values[4]}set translateX(e){this.values[4]=e}get translateY(){return this.values[5]}set translateY(e){this.values[5]=e}get rotation(){return j.degrees(this.values[0],this.values[1])}set rotation(e){const t=this.rotate(e-this.rotation);this.values[0]=t.values[0],this.values[1]=t.values[1],this.values[2]=t.values[2],this.values[3]=t.values[3]}get translation(){return new j(this.values[4],this.values[5])}set translation(e){const t=new j(e);this.values[4]=t.x,this.values[5]=t.y}get scaling(){return new j(this.values[0],this.values[3])}set scaling(e){const t=new j(e),s=new j(this.values[0],this.values[1]).normalized,i=new j(this.values[2],this.values[3]).normalized;this.values[0]=s.x*t.x,this.values[1]=s.y*t.y,this.values[2]=i.x*t.x,this.values[3]=i.y*t.y}get inverse(){const e=this.values[0],t=this.values[1],s=this.values[2],i=this.values[3],r=this.values[4],a=this.values[5];let n=e*i-t*s;return n?(n=1/n,new q(i*n,-t*n,-s*n,e*n,(s*a-i*r)*n,(t*r-e*a)*n)):null}get determinant(){return this.values[0]*this.values[3]-this.values[1]*this.values[2]}get domMatrix(){return new DOMMatrix([this.values[0],this.values[1],this.values[2],this.values[3],this.values[4],this.values[5]])}constructor(e,t,s,i,r,a){if(this.values=new Float32Array(6),0===arguments.length)return void(this.values=new Float32Array([1,0,0,1,0,0]));if(6===arguments.length)return this.values[0]=e,this.values[1]=t,this.values[2]=s,this.values[3]=i,this.values[4]=r,void(this.values[5]=a);if(e instanceof DOMMatrix)return this.values[0]=e.m11,this.values[1]=e.m12,this.values[2]=e.m21,this.values[3]=e.m22,this.values[4]=e.m41,void(this.values[5]=e.m42);if(e instanceof q)return void(this.values=e.values);if(Array.isArray(e)){if(2===e.length)return this.values[0]=e[0],this.values[1]=e[1],this.values[2]=t[0],this.values[3]=t[1],this.values[4]=s[0],void(this.values[5]=s[1]);if(3===e.length){const t=new j(e[0]),s=new j(e[1]),i=new j(e[2]);return this.values[0]=t.x,this.values[1]=t.y,this.values[2]=s.x,this.values[3]=s.y,this.values[4]=i.x,void(this.values[5]=i.y)}return this.values[0]=e[0],this.values[1]=e[1],this.values[2]=e[2],this.values[3]=e[3],this.values[4]=e[4],void(this.values[5]=e[5])}const n=new j(e),o=new j(t),h=new j(s);this.values[0]=n.x,this.values[1]=n.y,this.values[2]=o.x,this.values[3]=o.y,this.values[4]=h.x,this.values[5]=h.y}column(e){return new j(this.values[2*e],this.values[2*e+1])}row(e){return[this.values[e],this.values[e+2],this.values[e+4]]}mul(e){const t=this.values[0],s=this.values[1],i=this.values[2],r=this.values[3],a=this.values[4],n=this.values[5],o=e.values[0],h=e.values[1],l=e.values[2],u=e.values[3],c=e.values[4],d=e.values[5];return new q(t*o+i*h,s*o+r*h,t*l+i*u,s*l+r*u,t*c+i*d+a,s*c+r*d+n)}rotate(e,t){void 0===t&&(t=!0),t&&(e*=O);const s=this.values[0],i=this.values[1],r=this.values[2],a=this.values[3],n=this.values[4],o=this.values[5],h=Math.sin(e),l=Math.cos(e);return new q(s*l+r*h,i*l+a*h,s*-h+r*l,i*-h+a*l,n,o)}scale(e){const t=new j(e);return new q(this.values[0]*t.x,this.values[1]*t.x,this.values[2]*t.y,this.values[3]*t.y,this.values[4],this.values[5])}mulScalar(e){return new q(this.values[0]*e,this.values[1]*e,this.values[2]*e,this.values[3]*e,this.values[4]*e,this.values[5]*e)}translate(e){const t=new j(e);return new q(this.values[0],this.values[1],this.values[2],this.values[3],this.values[0]*t.x+this.values[2]*t.y+this.values[4],this.values[1]*t.x+this.values[3]*t.y+this.values[5])}add(e){return new q(this.values[0]+e.values[0],this.values[1]+e.values[1],this.values[2]+e.values[2],this.values[3]+e.values[3],this.values[4]+e.values[4],this.values[5]+e.values[5])}sub(e){return new q(this.values[0]-e.values[0],this.values[1]-e.values[1],this.values[2]-e.values[2],this.values[3]-e.values[3],this.values[4]-e.values[4],this.values[5]-e.values[5])}toSymbol(){return q.symbol}equals(e,t){return void 0===t&&(t=l),Math.abs(this.values[0]-e.values[0])<=t+Number.EPSILON&&Math.abs(this.values[1]-e.values[1])<=t+Number.EPSILON&&Math.abs(this.values[2]-e.values[2])<=t+Number.EPSILON&&Math.abs(this.values[3]-e.values[3])<=t+Number.EPSILON&&Math.abs(this.values[4]-e.values[4])<=t+Number.EPSILON&&Math.abs(this.values[5]-e.values[5])<=t+Number.EPSILON}exactlyEquals(e){return this.values[0]===e.values[0]&&this.values[1]===e.values[1]&&this.values[2]===e.values[2]&&this.values[3]===e.values[3]&&this.values[4]===e.values[4]&&this.values[5]===e.values[5]}}q.symbol=Symbol.for("@motion-canvas/core/types/Matrix2D"),q.identity=new q(1,0,0,1,0,0),q.zero=new q(0,0,0,0,0,0);class j{static createSignal(e,t,s){return void 0===t&&(t=j.lerp),new D(["x","y"],(e=>new j(e)),e,t,s).toSignal()}static lerp(e,t,s){let i,a;return"number"==typeof s?i=a=s:(i=s.x,a=s.y),new j(r(e.x,t.x,i),r(e.y,t.y,a))}static arcLerp(e,t,s,i,n){return void 0===i&&(i=!1),n??(n=e.sub(t).ctg),j.lerp(e,t,function(e,t,s){let i=t;s>1?s=1/s:i=!i;const n=r(i?Math.acos(a(-1,1,1-e)):Math.asin(e),r(0,Math.PI/2,e),s);let o=Math.sin(n),h=1-Math.cos(n);return t&&([o,h]=[h,o]),new j(o,h)}(s,i,n))}static createArcLerp(e,t){return(s,i,r)=>j.arcLerp(s,i,r,e,t)}static polarLerp(e,t,s,i,a){void 0===i&&(i=!1),void 0===a&&(a=j.zero),e=e.sub(a),t=t.sub(a);const n=e.degrees;let o=t.degrees;n>o!==i&&(o+=i?-360:360);const h=r(n,o,s)*O,l=r(e.magnitude,t.magnitude,s);return new j(l*Math.cos(h)+a.x,l*Math.sin(h)+a.y)}static createPolarLerp(e,t){return void 0===e&&(e=!1),void 0===t&&(t=j.zero),(s,i,r)=>j.polarLerp(s,i,r,e,new j(t))}static fromOrigin(e){const t=new j;return e===h.Middle||(e&o.Left?t.x=-1:e&o.Right&&(t.x=1),e&o.Top?t.y=-1:e&o.Bottom&&(t.y=1)),t}static fromScalar(e){return new j(e,e)}static fromRadians(e){return new j(Math.cos(e),Math.sin(e))}static fromDegrees(e){return j.fromRadians(e*O)}static radians(e,t){return Math.atan2(t,e)}static degrees(e,t){return j.radians(e,t)*z}static magnitude(e,t){return Math.sqrt(e*e+t*t)}static squaredMagnitude(e,t){return e*e+t*t}static angleBetween(e,t){return Math.acos(a(-1,1,e.dot(t)/(e.magnitude*t.magnitude)))*(e.cross(t)>=0?1:-1)}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}get magnitude(){return j.magnitude(this.x,this.y)}get squaredMagnitude(){return j.squaredMagnitude(this.x,this.y)}get normalized(){return this.scale(1/j.magnitude(this.x,this.y))}get safe(){return new j(isNaN(this.x)?0:this.x,isNaN(this.y)?0:this.y)}get flipped(){return new j(-this.x,-this.y)}get floored(){return new j(Math.floor(this.x),Math.floor(this.y))}get perpendicular(){return new j(this.y,-this.x)}get radians(){return j.radians(this.x,this.y)}get degrees(){return j.degrees(this.x,this.y)}get ctg(){return this.x/this.y}constructor(e,t){if(this.x=0,this.y=0,null!=e){if("object"!=typeof e)return this.x=e,void(this.y=t??e);if(Array.isArray(e))return this.x=e[0],void(this.y=e[1]);if("width"in e)return this.x=e.width,void(this.y=e.height);this.x=e.x,this.y=e.y}}lerp(e,t){return j.lerp(this,e,t)}getOriginOffset(e){const t=j.fromOrigin(e);return t.x*=this.x/2,t.y*=this.y/2,t}scale(e){return new j(this.x*e,this.y*e)}transformAsPoint(e){const t=new q(e);return new j(this.x*t.scaleX+this.y*t.skewY+t.translateX,this.x*t.skewX+this.y*t.scaleY+t.translateY)}transform(e){const t=new q(e);return new j(this.x*t.scaleX+this.y*t.skewY,this.x*t.skewX+this.y*t.scaleY)}mul(e){const t=new j(e);return new j(this.x*t.x,this.y*t.y)}div(e){const t=new j(e);return new j(this.x/t.x,this.y/t.y)}add(e){const t=new j(e);return new j(this.x+t.x,this.y+t.y)}sub(e){const t=new j(e);return new j(this.x-t.x,this.y-t.y)}dot(e){const t=new j(e);return this.x*t.x+this.y*t.y}cross(e){const t=new j(e);return this.x*t.y-this.y*t.x}mod(e){const t=new j(e);return new j(this.x%t.x,this.y%t.y)}rotate(e,t){void 0===t&&(t=j.zero);const s=new j(t),i=q.fromTranslation(s).rotate(e).translate(s.flipped);return this.transformAsPoint(i)}addX(e){return new j(this.x+e,this.y)}addY(e){return new j(this.x,this.y+e)}toSymbol(){return j.symbol}toString(){return`Vector2(${this.x}, ${this.y})`}serialize(){return{x:this.x,y:this.y}}exactlyEquals(e){return this.x===e.x&&this.y===e.y}equals(e,t){return void 0===t&&(t=l),Math.abs(this.x-e.x)<=t+Number.EPSILON&&Math.abs(this.y-e.y)<=t+Number.EPSILON}}j.symbol=Symbol.for("@motion-canvas/core/types/Vector2"),j.zero=new j,j.one=new j(1,1),j.right=new j(1,0),j.left=new j(-1,0),j.up=new j(0,1),j.down=new j(0,-1);class B{get canvasSize(){return this.size.scale(this.resolutionScale)}constructor(){this.background=null,this.resolutionScale=1,this.colorSpace="srgb",this.size=j.zero,this.finalBuffer=document.createElement("canvas"),this.currentBuffer=document.createElement("canvas"),this.previousBuffer=document.createElement("canvas");const e=this.colorSpace;this.context=i({colorSpace:e},this.finalBuffer),this.currentContext=i({colorSpace:e},this.currentBuffer),this.previousContext=i({colorSpace:e},this.previousBuffer)}configure(e){let{colorSpace:t=this.colorSpace,size:s=this.size,resolutionScale:r=this.resolutionScale,background:a=this.background}=e;t!==this.colorSpace&&(this.colorSpace=t,this.context=i({colorSpace:t},this.finalBuffer),this.currentContext=i({colorSpace:t},this.currentBuffer),this.previousContext=i({colorSpace:t},this.previousBuffer)),s.exactlyEquals(this.size)&&r===this.resolutionScale||(this.resolutionScale=r,this.size=s,this.resizeCanvas(this.context),this.resizeCanvas(this.currentContext),this.resizeCanvas(this.previousContext)),this.background="string"==typeof a?a:(null==a?void 0:a.serialize())??null}async render(e,t){t&&(this.transformCanvas(this.previousContext),await t.render(this.previousContext)),this.transformCanvas(this.currentContext),await e.render(this.currentContext);const s=this.canvasSize;this.context.clearRect(0,0,s.width,s.height),this.background&&(this.context.save(),this.context.fillStyle=this.background,this.context.fillRect(0,0,s.width,s.height),this.context.restore()),t&&this.context.drawImage(this.previousBuffer,0,0),this.context.drawImage(this.currentBuffer,0,0)}transformCanvas(e){const t=this.canvasSize.scale(.5);e.setTransform(this.resolutionScale,0,0,this.resolutionScale,t.x,t.y)}resizeCanvas(e){const t=this.canvasSize;e.canvas.width=t.width,e.canvas.height=t.height}}class F extends P{get current(){return this.value}set current(e){this.value=e,this.notifySubscribers(e)}constructor(e){super(),this.value=e,this.subscribable=new Z(this)}subscribe(e,t){void 0===t&&(t=!0);const s=super.subscribe(e);return t&&e(this.value),s}}class Z extends I{get current(){return this.dispatcher.current}subscribe(e,t){return void 0===t&&(t=!0),this.dispatcher.subscribe(e,t)}}var Y;!function(e){e[e.Playing=0]="Playing",e[e.Rendering=1]="Rendering",e[e.Paused=2]="Paused",e[e.Presenting=3]="Presenting"}(Y||(Y={}));class X{constructor(){this.frame=0,this.speed=1,this.fps=30,this.duration=0,this.finished=!1,this.slides=[],this.previousScene=null,this.state=Y.Paused,this.currentSceneReference=null,this.scenes=new F([])}get onSceneChanged(){if(null===this.currentSceneReference)throw new Error("PlaybackManager has not been properly initialized");return this.currentSceneReference.subscribable}get onScenesRecalculated(){return this.scenes.subscribable}get currentScene(){if(null===this.currentSceneReference)throw new Error("PlaybackManager has not been properly initialized");return this.currentSceneReference.current}set currentScene(e){if(!e)throw new Error("Invalid scene.");this.currentSceneReference??(this.currentSceneReference=new F(e)),this.currentSceneReference.current=e}setup(e){this.scenes.current=e,this.currentScene=e[0]}async progress(){return this.finished=await this.next(),this.finished}async seek(e){if(e<=this.frame||this.currentScene.isCached()&&this.currentScene.lastFrame<e){const t=this.findBestScene(e);t!==this.currentScene?(this.previousScene=null,this.currentScene=t,this.frame=this.currentScene.firstFrame,await this.currentScene.reset()):this.frame>=e&&(this.previousScene=null,this.frame=this.currentScene.firstFrame,await this.currentScene.reset())}for(this.finished=!1;this.frame<e&&!this.finished;)this.finished=await this.next();return this.finished}async goBack(){let e=this.currentScene.slides.getCurrent();if(e&&this.currentScene.slides.isWaiting()){const t=this.slides.indexOf(e);e=this.slides[t-1]}await this.seekSlide(e)}async goForward(){const e=this.currentScene.slides.getCurrent(),t=this.slides.indexOf(e);await this.seekSlide(this.slides[t+1])}async goTo(e){await this.seekSlide(this.slides.find((t=>t.id===e)))}async seekSlide(e){if(void 0===e&&(e=null),!e)return;const{id:t,scene:s}=e;for((this.currentScene!==s||this.currentScene.slides.didHappen(t))&&(this.previousScene=null,this.currentScene=s,this.frame=this.currentScene.firstFrame,this.currentScene.slides.setTarget(t),await this.currentScene.reset()),this.finished=!1,this.currentScene.slides.setTarget(t);!this.currentScene.slides.isWaitingFor(t)&&!this.finished;)this.finished=await this.next();return this.currentScene.slides.setTarget(null),this.finished}async reset(){this.previousScene=null,this.currentScene=this.scenes.current[0],this.frame=0,await this.currentScene.reset()}reload(e){this.scenes.current.forEach((t=>t.reload(e)))}async recalculate(){this.previousScene=null,this.slides=[];const e=this.speed;this.frame=0,this.speed=1;const t=[];try{for(const e of this.scenes.current)await e.recalculate((e=>{this.frame=e})),this.slides.push(...e.slides.onChanged.current),t.push(e)}finally{this.speed=e}this.scenes.current=t,this.duration=this.frame}async next(){if(this.previousScene&&(await this.previousScene.next(),this.currentScene.isFinished()&&(this.previousScene=null)),this.frame+=this.speed,this.currentScene.isFinished())return!0;if(await this.currentScene.next(),this.previousScene&&this.currentScene.isAfterTransitionIn()&&(this.previousScene=null),this.currentScene.canTransitionOut()){this.previousScene=this.currentScene;const e=this.getNextScene(this.previousScene);e&&(this.currentScene=e,await this.currentScene.reset(this.previousScene)),e&&!this.currentScene.isAfterTransitionIn()||(this.previousScene=null)}return this.currentScene.isFinished()}findBestScene(e){let t=this.scenes.current[0];for(const s of this.scenes.current){if(!s.isCached()||s.lastFrame>e)return s;t=s}return t}getNextScene(e){const t=this.scenes.current;if(!e)return t[0];const s=t.findIndex((t=>t===e));return s<0?null:t[s+1]??null}}class H{get onDataChanged(){return this.data.subscribable}constructor(e){this.logger=e,this.data=new F(null),this.context=new AudioContext,this.audioElement=new Audio,this.source=null,this.error=!1,this.abortController=null,this.offset=0}getTime(){return this.toAbsoluteTime(this.audioElement.currentTime)}setTime(e){this.audioElement.currentTime=this.toRelativeTime(e)}setOffset(e){this.offset=e}setMuted(e){this.audioElement.muted=e}setSource(e){var t;this.source=e,this.audioElement.src=e,null==(t=this.abortController)||t.abort(),this.abortController=new AbortController,this.loadData(this.abortController.signal).catch((e=>{"AbortError"!==e.name&&this.logger.error(e)}))}isInRange(e){return e>=this.offset&&e<this.audioElement.duration}toRelativeTime(e){return Math.max(0,e-this.offset)}toAbsoluteTime(e){return e+this.offset}isReady(){return this.source&&!this.error}async setPaused(e){if(this.source&&this.audioElement.paused!==e)if(e)this.audioElement.pause();else try{return await this.audioElement.play(),this.error=!1,!0}catch(t){this.error||x().error(t),this.error=!0}return!1}async loadData(e){if(this.data.current=null,!this.source)return;const t=await fetch(this.source,{signal:e}),s=await t.arrayBuffer();if(e.aborted)return;let i;try{i=await this.decodeAudioData(s)}catch(h){return}if(e.aborted)return;const r=256,a=~~(i.length/r),n=[];let o=0;for(let l=0;l<i.numberOfChannels;l++){const e=i.getChannelData(l);for(let t=0;t<a;t++){const s=~~(t*r),i=~~(s+r);let a=e[s],h=a;for(let t=s;t<i;t++){const s=e[t];s>h&&(h=s),s<a&&(a=s)}(0===l||h>n[2*t])&&(n[2*t]=h),(0===l||a<n[2*t+1])&&(n[2*t+1]=a),h>o&&(o=h),Math.abs(a)>o&&(o=Math.abs(a))}}this.data.current={peaks:n,absoluteMax:o,length:a,sampleRate:i.sampleRate/r*2}}decodeAudioData(e){return new Promise(((t,s)=>this.context.decodeAudioData(e,t,s).catch(s)))}}class G extends P{async dispatch(e){await Promise.all(this.notifySubscribers(e))}}class W extends P{dispatch(e){this.notifySubscribers(e)}}class V{constructor(e){this.playback=e}secondsToFrames(e){return Math.ceil(e*this.playback.fps)}framesToSeconds(e){return e/this.playback.fps}get time(){return this.framesToSeconds(this.playback.frame)}get frame(){return this.playback.frame}get speed(){return this.playback.speed}get fps(){return this.playback.fps}get state(){return this.playback.state}}class J{constructor(){this.resolveCurrent=null,this.current=null}async acquire(){for(;this.current;)await this.current;this.current=new Promise((e=>{this.resolveCurrent=e}))}release(){var e;this.current=null,null==(e=this.resolveCurrent)||e.call(this),this.resolveCurrent=null}}class Q{get onChanged(){return this.events.subscribable}constructor(e){this.scene=e,this.events=new F([]),this.registeredEvents=new Map,this.lookup=new Map,this.collisionLookup=new Set,this.previousReference=[],this.didEventsChange=!1,this.preserveTiming=!0,this.handleReload=()=>{this.registeredEvents.clear(),this.collisionLookup.clear()},this.handleRecalculated=()=>{var e;this.preserveTiming=!0,this.events.current=[...this.registeredEvents.values()],(this.didEventsChange||((null==(e=this.previousReference)?void 0:e.length)??0)!==this.events.current.length)&&(this.didEventsChange=!1,this.previousReference=[...this.registeredEvents.values()].map((e=>({name:e.name,targetTime:e.targetTime}))),this.scene.meta.timeEvents.set(this.previousReference))},this.handleReset=()=>{this.collisionLookup.clear()},this.handleMetaChanged=e=>{e!==this.previousReference&&(this.previousReference=e,this.load(e),this.scene.reload())},this.previousReference=e.meta.timeEvents.get(),this.load(this.previousReference),e.onReloaded.subscribe(this.handleReload),e.onRecalculated.subscribe(this.handleRecalculated),e.onReset.subscribe(this.handleReset),e.meta.timeEvents.onChanged.subscribe(this.handleMetaChanged,!1)}set(e,t,s){void 0===s&&(s=!0);let i=this.lookup.get(e);i&&i.offset!==t&&(this.preserveTiming=s,i={...i,targetTime:i.initialTime+t,offset:t},this.lookup.set(e,i),this.registeredEvents.set(e,i),this.events.current=[...this.registeredEvents.values()],this.didEventsChange=!0,this.scene.reload())}register(e,t){if(this.collisionLookup.has(e))return this.scene.logger.error({message:`name "${e}" has already been used for another event name.`,stack:(new Error).stack}),0;this.collisionLookup.add(e);let s=this.lookup.get(e);if(s){let i=!1;const r={...s},a=(new Error).stack;r.stack!==a&&(r.stack=a,i=!0),r.initialTime!==t&&(r.initialTime=t,i=!0);const n=Math.max(0,r.targetTime-r.initialTime);this.preserveTiming&&r.offset!==n&&(r.offset=n,i=!0);const o=r.initialTime+r.offset;this.preserveTiming||r.targetTime===o||(this.didEventsChange=!0,r.targetTime=o,i=!0),i&&(s=r,this.lookup.set(e,s))}else this.didEventsChange=!0,s={name:e,initialTime:t,targetTime:t,offset:0,stack:(new Error).stack},this.lookup.set(e,s);return this.registeredEvents.set(e,s),s.offset}load(e){for(const t of e){const e=this.lookup.get(t.name)??{name:t.name,initialTime:0,offset:0};this.lookup.set(t.name,{...e,targetTime:t.targetTime})}}}class ${get onRender(){return this.render.subscribable}get onStateChanged(){return this.playerState.subscribable}get onFrameChanged(){return this.frame.subscribable}get onDurationChanged(){return this.duration.subscribable}get onRecalculated(){return this.recalculated.subscribable}get startFrame(){return Math.min(this.playback.duration,this.status.secondsToFrames(this.startTime))}get endFrame(){return Math.min(this.playback.duration,this.status.secondsToFrames(this.endTime))}get finished(){return this.playback.finished||this.playback.frame>=this.endFrame}constructor(e,t,s,i){var r,a;void 0===t&&(t={}),void 0===s&&(s={}),void 0===i&&(i=-1),this.project=e,this.settings=t,this.initialState=s,this.initialFrame=i,this.render=new G,this.frame=new F(0),this.duration=new F(0),this.recalculated=new W,this.lock=new J,this.startTime=0,this.endTime=1/0,this.requestId=null,this.renderTime=0,this.requestedSeek=-1,this.requestedRecalculation=!0,this.active=!1,this.playerState=new F({loop:!0,muted:!0,speed:1,...s,paused:!0}),this.requestedSeek=i,this.logger=this.project.logger,this.playback=new X,this.status=new V(this.playback),this.audio=new H(this.logger),this.size=t.size??new j(1920,1080),this.resolutionScale=t.resolutionScale??1,this.startTime=(null==(r=t.range)?void 0:r[0])??0,this.endTime=(null==(a=t.range)?void 0:a[1])??1/0,this.playback.fps=t.fps??60,this.audio.setOffset(t.audioOffset??0),e.audio&&this.audio.setSource(e.audio);const n=[];for(const h of e.scenes){var o;const t=new h.klass({...h,playback:this.status,logger:this.project.logger,size:this.size,resolutionScale:this.resolutionScale,timeEventsClass:Q});null==(o=h.onReplaced)||o.subscribe((e=>{t.reload(e)}),!1),t.onReloaded.subscribe((()=>this.requestRecalculation())),t.variables.updateSignals(e.variables??{}),n.push(t)}this.playback.setup(n),this.activate()}async configure(e){await this.lock.acquire();let t=this.playback.frame,s=!1;if(this.startTime=e.range[0],this.endTime=e.range[1],this.playback.fps!==e.fps){const i=e.fps/this.playback.fps;this.playback.fps=e.fps,t=Math.floor(t*i),s=!0}e.size.exactlyEquals(this.size)&&e.resolutionScale===this.resolutionScale||(this.size=e.size,this.resolutionScale=e.resolutionScale,this.playback.reload({size:this.size,resolutionScale:this.resolutionScale})),void 0!==e.audioOffset&&this.audio.setOffset(e.audioOffset),this.lock.release(),s&&(this.playback.reload(),this.frame.current=t,this.requestRecalculation(),this.requestedSeek=t)}requestSeek(e){this.requestedSeek=this.clampRange(e)}requestPreviousFrame(){this.requestedSeek=this.frame.current-this.playback.speed}requestNextFrame(){this.requestedSeek=this.frame.current+this.playback.speed}requestReset(){this.requestedSeek=0}toggleLoop(e){void 0===e&&(e=!this.playerState.current.loop),e!==this.playerState.current.loop&&(this.playerState.current={...this.playerState.current,loop:e})}togglePlayback(e){void 0===e&&(e=this.playerState.current.paused),e===this.playerState.current.paused&&(this.playerState.current={...this.playerState.current,paused:!e},e&&!this.playerState.current.loop&&this.playback.frame===this.playback.duration&&this.requestReset())}toggleAudio(e){void 0===e&&(e=this.playerState.current.muted),e===this.playerState.current.muted&&(this.playerState.current={...this.playerState.current,muted:!e})}setSpeed(e){e!==this.playerState.current.speed&&(this.playback.speed=e,this.playback.reload(),this.playerState.current={...this.playerState.current,speed:e},this.requestRecalculation())}setVariables(e){for(const t of this.playback.onScenesRecalculated.current)t.variables.updateSignals(e)}activate(){this.active=!0,this.request()}deactivate(){this.active=!1,null!==this.requestId&&(cancelAnimationFrame(this.requestId),this.requestId=null)}requestRecalculation(){this.requestedRecalculation=!0,this.request()}async prepare(){const e={...this.playerState.current,seek:this.requestedSeek};if(this.requestedSeek=-1,this.requestedRecalculation){e.seek<0&&(e.seek=this.playback.frame);try{await this.playback.recalculate(),this.duration.current=this.playback.frame,this.recalculated.dispatch()}catch(s){throw this.requestSeek(e.seek),s}finally{this.requestedRecalculation=!1}}(!e.loop&&this.finished&&!e.paused&&e.seek<0||this.endFrame===this.startFrame)&&(this.togglePlayback(!1),e.paused=!0),e.loop&&(e.seek>this.endFrame||this.finished&&!e.paused)&&this.startFrame!==this.endTime&&(e.seek=this.startFrame);const t=e.paused||this.finished||!this.audio.isInRange(this.status.time);return await this.audio.setPaused(t)&&this.syncAudio(-3),this.audio.setMuted(e.muted),e}async run(){const e=await this.prepare(),t=this.playback.state;if(this.playback.state=e.paused?Y.Paused:Y.Playing,e.seek>=0||!this.isInRange(this.status.frame)){const t=e.seek<0?this.status.frame:e.seek,s=this.clampRange(t);this.logger.profile("seek time"),await this.playback.seek(s),this.logger.profile("seek time"),this.syncAudio(-3)}else{if(e.paused||1===e.speed&&this.audio.isReady()&&this.audio.isInRange(this.status.time)&&this.audio.getTime()<this.status.time)return e.paused&&t!==Y.Paused&&await this.render.dispatch(),!e.paused&&this.status.time>this.audio.getTime()+.02&&this.syncAudio(),void this.request();if(this.audio.isReady()&&1===e.speed&&this.audio.isInRange(this.status.time)&&this.status.framesToSeconds(this.playback.frame+1)<this.audio.getTime()-.02){const e=this.status.secondsToFrames(this.audio.getTime());await this.playback.seek(e)}else this.status.frame<this.endFrame&&(await this.playback.progress(),1!==e.speed&&this.syncAudio())}!e.paused&&this.playback.currentScene.slides.isWaiting()&&(this.togglePlayback(!1),e.paused=!0),await this.render.dispatch(),this.frame.current=this.playback.frame,this.request()}request(){this.active&&(this.requestId??(this.requestId=requestAnimationFrame((async e=>{if(this.requestId=null,e-this.renderTime>=1e3/(this.status.fps+5)){this.renderTime=e,await this.lock.acquire();try{await this.run()}catch(t){this.logger.error(t)}this.lock.release()}else this.request()}))))}clampRange(e){return a(this.startFrame,this.endFrame,e)}isInRange(e){return e>=this.startFrame&&e<=this.endFrame}syncAudio(e){void 0===e&&(e=0),this.audio.setTime(this.status.framesToSeconds(this.playback.frame+e))}}var _=Object.defineProperty,U=(e,t,s)=>(((e,t,s)=>{t in e?_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s})(e,"symbol"!=typeof t?t+"":t,s),s);const K=[];class ee extends Error{constructor(e,t){super(e),this.remarks=t}}const te=[];function se(){const e=te.at(-1);if(!e)throw new ee("The thread is not available in the current context.","<p><code>useThread()</code> can only be called from within generator functions.\n      It&#39;s not available during rendering.</p>\n");return e}function ie(e){return{message:e.message,stack:e.stack,remarks:e.remarks}}const re=180/Math.PI,ae=Math.PI/180,ne=[];function oe(e){const t={[e.name]:e},s=Object.getOwnPropertyDescriptor(t,e.name);for(var i=arguments.length,r=new Array(i>1?i-1:0),a=1;a<i;a++)r[a-1]=arguments[a];if(s)for(let n=r.length-1;n>=0;n--)r[n](t,e.name,s)}function he(e){return function(t,s,i){i.value.prototype.name=e??s,i.value.prototype.threadable=!0}}function le(e,t){const s=Object.getPrototypeOf(e);s.threadable||(s.threadable=!0,s.name="string"==typeof t?t:function(e){return Object.getPrototypeOf(e).name??null}(t))}class ue{constructor(){this.subscribable=new ce(this),this.subscribers=new Set}subscribe(e){return this.subscribers.add(e),()=>this.unsubscribe(e)}unsubscribe(e){this.subscribers.delete(e)}clear(){this.subscribers.clear()}notifySubscribers(e){return[...this.subscribers].map((t=>t(e)))}}class ce{constructor(e){this.dispatcher=e}subscribe(e){return this.dispatcher.subscribe(e)}unsubscribe(e){this.dispatcher.unsubscribe(e)}}class de extends ue{constructor(){super(...arguments),this.value=!1}raise(){this.value||(this.value=!0,this.notifySubscribers())}reset(){this.value=!1}isRaised(){return this.value}subscribe(e){const t=super.subscribe(e);return this.value&&e(),t}}function ve(e){const t=function(){const e=K.at(-1);if(!e)throw new Error("The scene is not available in the current context.");return e}(),s=se();return t.timeEvents.register(e,s.time())}function pe(e,t,s){return e+(t-e)*s}function ye(e,t,s){return s<e?e:s>t?t:s}function fe(e,t,s){return void 0===t&&(t=0),void 0===s&&(s=1),pe(t,s,e=e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2)}function*ge(e,t,s){const i=se(),r=i.time(),a=i.time()+e;for(t(0,0);a>i.fixed;){const s=i.fixed-r;s>0&&t(s/e,s),yield}i.time(a),t(1,e),null==s||s(1,e)}function*me(e,t){void 0===e&&(e=0);const s=se(),i=function(){const e=ne.at(-1);if(!e)throw new Error("The playback is not available in the current context.");return e}().framesToSeconds(1),r=s.time()+e;for(;r-i>s.fixed;)yield;s.time(r),t&&(yield*t)}function be(e,t){let s;return"string"==typeof e?(s=t(),le(s,e)):(s=e(),le(s,s)),s}oe(ge,he()),oe((function*(e,t){yield*me(ve(e)),t&&(yield*t)}),he()),oe(me,he());class we{static collectPromise(e,t){void 0===t&&(t=null);const s={promise:e,value:t,stack:(new Error).stack},i=this.collectionStack.at(-1);return i&&(s.owner=i.owner),e.then((e=>{s.value=e,null==i||i.markDirty()})),this.promises.push(s),s}static hasPromises(){return this.promises.length>0}static async consumePromises(){const e=[...this.promises];return await Promise.all(e.map((e=>e.promise))),this.promises=this.promises.filter((t=>!e.includes(t))),e}constructor(e){this.owner=e,this.dependencies=new Set,this.event=new de,this.markDirty=()=>this.event.raise(),this.invokable=this.invoke.bind(this),Object.defineProperty(this.invokable,"context",{value:this}),Object.defineProperty(this.invokable,"toPromise",{value:this.toPromise.bind(this)})}invoke(){}startCollecting(){if(we.collectionSet.has(this))throw new ee("A circular dependency occurred between signals.","This can happen when signals reference each other in a loop.\n        Try using the attached stack trace to locate said loop.");we.collectionSet.add(this),we.collectionStack.push(this)}finishCollecting(){if(we.collectionSet.delete(this),we.collectionStack.pop()!==this)throw new Error("collectStart/collectEnd was called out of order.")}clearDependencies(){this.dependencies.forEach((e=>e.unsubscribe(this.markDirty))),this.dependencies.clear()}collect(){const e=we.collectionStack.at(-1);e&&(e.dependencies.add(this.event.subscribable),this.event.subscribe(e.markDirty))}dispose(){this.clearDependencies(),this.event.clear(),this.owner=null}async toPromise(){do{await we.consumePromises(),this.invokable()}while(we.hasPromises());return this.invokable}}function xe(e){return"function"==typeof e}function Se(e,t){return xe(e)?()=>t(e()):t(e)}we.collectionSet=new Set,we.collectionStack=[],we.promises=[];const ke=Symbol.for("@motion-canvas/core/signals/default");class Me extends we{constructor(e,t,s,i,r){void 0===s&&(s=void 0),void 0===i&&(i=e=>e),void 0===r&&(r={}),super(s),this.initial=e,this.interpolation=t,this.parser=i,Object.defineProperty(this.invokable,"reset",{value:this.reset.bind(this)}),Object.defineProperty(this.invokable,"save",{value:this.save.bind(this)}),Object.defineProperty(this.invokable,"isInitial",{value:this.isInitial.bind(this)}),void 0!==this.initial&&(this.current=this.initial,this.markDirty(),xe(this.initial)||(this.last=this.parse(this.initial))),this.extensions={getter:this.getter.bind(this),setter:this.setter.bind(this),tweener:this.tweener.bind(this),...r}}toSignal(){return this.invokable}parse(e){return this.parser(e)}set(e){return this.extensions.setter(e),this.owner}setter(e){return e===ke&&(e=this.initial),this.current===e||(this.current=e,this.markDirty(),this.clearDependencies(),xe(e)||(this.last=this.parse(e))),this.owner}get(){return this.extensions.getter()}getter(){var e;if(this.event.isRaised()&&xe(this.current)){this.clearDependencies(),this.startCollecting();try{this.last=this.parse(this.current())}catch(t){(function(){var e;return(null==(e=K.at(-1))?void 0:e.logger)??console})().error({...ie(t),inspect:null==(e=this.owner)?void 0:e.key})}this.finishCollecting()}return this.event.reset(),this.collect(),this.last}invoke(e,t,s,i){return void 0===s&&(s=fe),void 0===i&&(i=this.interpolation),void 0===e?this.get():void 0===t?this.set(e):this.createQueue(s,i).to(e,t)}createQueue(e,t){var s=this;const i=this.get(),r=[],a=be("animation chain",(function*(){for(;r.length>0;)yield*r.shift()}));return a.to=function(i,n,o,h){return void 0===o&&(o=e),void 0===h&&(h=t),e=o,t=h,r.push(s.tween(i,n,o,h)),a},a.back=function(n,o,h){return void 0===o&&(o=e),void 0===h&&(h=t),e=o,t=h,r.push(s.tween(i,n,e,t)),a},a.wait=e=>(r.push(me(e)),a),a.run=e=>(r.push(e),a),a.do=e=>(r.push(be((function*(){e()}))),a),a}*tween(e,t,s,i){e===ke&&(e=this.initial),yield*this.extensions.tweener(e,t,s,i),this.set(e)}*tweener(e,t,s,i){const r=this.get();yield*ge(t,(t=>{this.set(i(r,this.parse(function(e){return xe(e)?e():e}(e)),s(t)))}))}dispose(){super.dispose(),this.initial=void 0,this.current=void 0,this.last=void 0}reset(){return void 0!==this.initial&&this.set(this.initial),this.owner}save(){return this.set(this.get())}isInitial(){return this.collect(),this.current===this.initial}raw(){return this.current}}class Te extends Me{constructor(e,t,s,i,r,a){var n;void 0===r&&(r=void 0),void 0===a&&(a={}),super(void 0,i,r,t,a),this.entries=e,this.signals=[],this.parser=t;for(const o of e){let e,i;Array.isArray(o)?([e,i]=o,(n=i.context).owner??(n.owner=this)):(e=o,i=new Me(Se(s,(e=>t(e)[o])),pe,r??this.invokable).toSignal()),this.signals.push([e,i]),Object.defineProperty(this.invokable,e,{value:i})}}toSignal(){return this.invokable}parse(e){return this.parser(e)}getter(){return this.parse(Object.fromEntries(this.signals.map((e=>{let[t,s]=e;return[t,s()]}))))}setter(e){if(xe(e))for(const[t,s]of this.signals)s((()=>this.parser(e())[t]));else{const t=this.parse(e);for(const[e,s]of this.signals)s(t[e])}return this.owner}reset(){for(const[,e]of this.signals)e.reset();return this.owner}save(){for(const[,e]of this.signals)e.save();return this.owner}}var Pe,Ie,Ce;!function(e){e[e.Vertical=1]="Vertical",e[e.Horizontal=2]="Horizontal"}(Pe||(Pe={})),function(e){e[e.Top=4]="Top",e[e.Bottom=8]="Bottom",e[e.Left=16]="Left",e[e.Right=32]="Right"}(Ie||(Ie={})),function(e){e[e.Middle=3]="Middle",e[e.Top=5]="Top",e[e.Bottom=9]="Bottom",e[e.Left=18]="Left",e[e.Right=34]="Right",e[e.TopLeft=20]="TopLeft",e[e.TopRight=36]="TopRight",e[e.BottomLeft=24]="BottomLeft",e[e.BottomRight=40]="BottomRight"}(Ce||(Ce={}));const Re=1e-6;class Ee{static fromRotation(e){return Ee.identity.rotate(e)}static fromTranslation(e){return Ee.identity.translate(new Le(e))}static fromScaling(e){return Ee.identity.scale(new Le(e))}get x(){return new Le(this.values[0],this.values[1])}get y(){return new Le(this.values[2],this.values[3])}get scaleX(){return this.values[0]}set scaleX(e){this.values[0]=this.x.normalized.scale(e).x}get skewX(){return this.values[1]}set skewX(e){this.values[1]=e}get scaleY(){return this.values[3]}set scaleY(e){this.values[3]=this.y.normalized.scale(e).y}get skewY(){return this.values[2]}set skewY(e){this.values[2]=e}get translateX(){return this.values[4]}set translateX(e){this.values[4]=e}get translateY(){return this.values[5]}set translateY(e){this.values[5]=e}get rotation(){return Le.degrees(this.values[0],this.values[1])}set rotation(e){const t=this.rotate(e-this.rotation);this.values[0]=t.values[0],this.values[1]=t.values[1],this.values[2]=t.values[2],this.values[3]=t.values[3]}get translation(){return new Le(this.values[4],this.values[5])}set translation(e){const t=new Le(e);this.values[4]=t.x,this.values[5]=t.y}get scaling(){return new Le(this.values[0],this.values[3])}set scaling(e){const t=new Le(e),s=new Le(this.values[0],this.values[1]).normalized,i=new Le(this.values[2],this.values[3]).normalized;this.values[0]=s.x*t.x,this.values[1]=s.y*t.y,this.values[2]=i.x*t.x,this.values[3]=i.y*t.y}get inverse(){const e=this.values[0],t=this.values[1],s=this.values[2],i=this.values[3],r=this.values[4],a=this.values[5];let n=e*i-t*s;return n?(n=1/n,new Ee(i*n,-t*n,-s*n,e*n,(s*a-i*r)*n,(t*r-e*a)*n)):null}get determinant(){return this.values[0]*this.values[3]-this.values[1]*this.values[2]}get domMatrix(){return new DOMMatrix([this.values[0],this.values[1],this.values[2],this.values[3],this.values[4],this.values[5]])}constructor(e,t,s,i,r,a){if(this.values=new Float32Array(6),0===arguments.length)return void(this.values=new Float32Array([1,0,0,1,0,0]));if(6===arguments.length)return this.values[0]=e,this.values[1]=t,this.values[2]=s,this.values[3]=i,this.values[4]=r,void(this.values[5]=a);if(e instanceof DOMMatrix)return this.values[0]=e.m11,this.values[1]=e.m12,this.values[2]=e.m21,this.values[3]=e.m22,this.values[4]=e.m41,void(this.values[5]=e.m42);if(e instanceof Ee)return void(this.values=e.values);if(Array.isArray(e)){if(2===e.length)return this.values[0]=e[0],this.values[1]=e[1],this.values[2]=t[0],this.values[3]=t[1],this.values[4]=s[0],void(this.values[5]=s[1]);if(3===e.length){const t=new Le(e[0]),s=new Le(e[1]),i=new Le(e[2]);return this.values[0]=t.x,this.values[1]=t.y,this.values[2]=s.x,this.values[3]=s.y,this.values[4]=i.x,void(this.values[5]=i.y)}return this.values[0]=e[0],this.values[1]=e[1],this.values[2]=e[2],this.values[3]=e[3],this.values[4]=e[4],void(this.values[5]=e[5])}const n=new Le(e),o=new Le(t),h=new Le(s);this.values[0]=n.x,this.values[1]=n.y,this.values[2]=o.x,this.values[3]=o.y,this.values[4]=h.x,this.values[5]=h.y}column(e){return new Le(this.values[2*e],this.values[2*e+1])}row(e){return[this.values[e],this.values[e+2],this.values[e+4]]}mul(e){const t=this.values[0],s=this.values[1],i=this.values[2],r=this.values[3],a=this.values[4],n=this.values[5],o=e.values[0],h=e.values[1],l=e.values[2],u=e.values[3],c=e.values[4],d=e.values[5];return new Ee(t*o+i*h,s*o+r*h,t*l+i*u,s*l+r*u,t*c+i*d+a,s*c+r*d+n)}rotate(e,t){void 0===t&&(t=!0),t&&(e*=ae);const s=this.values[0],i=this.values[1],r=this.values[2],a=this.values[3],n=this.values[4],o=this.values[5],h=Math.sin(e),l=Math.cos(e);return new Ee(s*l+r*h,i*l+a*h,s*-h+r*l,i*-h+a*l,n,o)}scale(e){const t=new Le(e);return new Ee(this.values[0]*t.x,this.values[1]*t.x,this.values[2]*t.y,this.values[3]*t.y,this.values[4],this.values[5])}mulScalar(e){return new Ee(this.values[0]*e,this.values[1]*e,this.values[2]*e,this.values[3]*e,this.values[4]*e,this.values[5]*e)}translate(e){const t=new Le(e);return new Ee(this.values[0],this.values[1],this.values[2],this.values[3],this.values[0]*t.x+this.values[2]*t.y+this.values[4],this.values[1]*t.x+this.values[3]*t.y+this.values[5])}add(e){return new Ee(this.values[0]+e.values[0],this.values[1]+e.values[1],this.values[2]+e.values[2],this.values[3]+e.values[3],this.values[4]+e.values[4],this.values[5]+e.values[5])}sub(e){return new Ee(this.values[0]-e.values[0],this.values[1]-e.values[1],this.values[2]-e.values[2],this.values[3]-e.values[3],this.values[4]-e.values[4],this.values[5]-e.values[5])}toSymbol(){return Ee.symbol}equals(e,t){return void 0===t&&(t=Re),Math.abs(this.values[0]-e.values[0])<=t+Number.EPSILON&&Math.abs(this.values[1]-e.values[1])<=t+Number.EPSILON&&Math.abs(this.values[2]-e.values[2])<=t+Number.EPSILON&&Math.abs(this.values[3]-e.values[3])<=t+Number.EPSILON&&Math.abs(this.values[4]-e.values[4])<=t+Number.EPSILON&&Math.abs(this.values[5]-e.values[5])<=t+Number.EPSILON}exactlyEquals(e){return this.values[0]===e.values[0]&&this.values[1]===e.values[1]&&this.values[2]===e.values[2]&&this.values[3]===e.values[3]&&this.values[4]===e.values[4]&&this.values[5]===e.values[5]}}Ee.symbol=Symbol.for("@motion-canvas/core/types/Matrix2D"),Ee.identity=new Ee(1,0,0,1,0,0),Ee.zero=new Ee(0,0,0,0,0,0);class Le{static createSignal(e,t,s){return void 0===t&&(t=Le.lerp),new Te(["x","y"],(e=>new Le(e)),e,t,s).toSignal()}static lerp(e,t,s){let i,r;return"number"==typeof s?i=r=s:(i=s.x,r=s.y),new Le(pe(e.x,t.x,i),pe(e.y,t.y,r))}static arcLerp(e,t,s,i,r){return void 0===i&&(i=!1),r??(r=e.sub(t).ctg),Le.lerp(e,t,function(e,t,s){let i=t;s>1?s=1/s:i=!i;const r=pe(i?Math.acos(ye(-1,1,1-e)):Math.asin(e),pe(0,Math.PI/2,e),s);let a=Math.sin(r),n=1-Math.cos(r);return t&&([a,n]=[n,a]),new Le(a,n)}(s,i,r))}static createArcLerp(e,t){return(s,i,r)=>Le.arcLerp(s,i,r,e,t)}static polarLerp(e,t,s,i,r){void 0===i&&(i=!1),void 0===r&&(r=Le.zero),e=e.sub(r),t=t.sub(r);const a=e.degrees;let n=t.degrees;a>n!==i&&(n+=i?-360:360);const o=pe(a,n,s)*ae,h=pe(e.magnitude,t.magnitude,s);return new Le(h*Math.cos(o)+r.x,h*Math.sin(o)+r.y)}static createPolarLerp(e,t){return void 0===e&&(e=!1),void 0===t&&(t=Le.zero),(s,i,r)=>Le.polarLerp(s,i,r,e,new Le(t))}static fromOrigin(e){const t=new Le;return e===Ce.Middle||(e&Ie.Left?t.x=-1:e&Ie.Right&&(t.x=1),e&Ie.Top?t.y=-1:e&Ie.Bottom&&(t.y=1)),t}static fromScalar(e){return new Le(e,e)}static fromRadians(e){return new Le(Math.cos(e),Math.sin(e))}static fromDegrees(e){return Le.fromRadians(e*ae)}static radians(e,t){return Math.atan2(t,e)}static degrees(e,t){return Le.radians(e,t)*re}static magnitude(e,t){return Math.sqrt(e*e+t*t)}static squaredMagnitude(e,t){return e*e+t*t}static angleBetween(e,t){return Math.acos(ye(-1,1,e.dot(t)/(e.magnitude*t.magnitude)))*(e.cross(t)>=0?1:-1)}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}get magnitude(){return Le.magnitude(this.x,this.y)}get squaredMagnitude(){return Le.squaredMagnitude(this.x,this.y)}get normalized(){return this.scale(1/Le.magnitude(this.x,this.y))}get safe(){return new Le(isNaN(this.x)?0:this.x,isNaN(this.y)?0:this.y)}get flipped(){return new Le(-this.x,-this.y)}get floored(){return new Le(Math.floor(this.x),Math.floor(this.y))}get perpendicular(){return new Le(this.y,-this.x)}get radians(){return Le.radians(this.x,this.y)}get degrees(){return Le.degrees(this.x,this.y)}get ctg(){return this.x/this.y}constructor(e,t){if(this.x=0,this.y=0,null!=e){if("object"!=typeof e)return this.x=e,void(this.y=t??e);if(Array.isArray(e))return this.x=e[0],void(this.y=e[1]);if("width"in e)return this.x=e.width,void(this.y=e.height);this.x=e.x,this.y=e.y}}lerp(e,t){return Le.lerp(this,e,t)}getOriginOffset(e){const t=Le.fromOrigin(e);return t.x*=this.x/2,t.y*=this.y/2,t}scale(e){return new Le(this.x*e,this.y*e)}transformAsPoint(e){const t=new Ee(e);return new Le(this.x*t.scaleX+this.y*t.skewY+t.translateX,this.x*t.skewX+this.y*t.scaleY+t.translateY)}transform(e){const t=new Ee(e);return new Le(this.x*t.scaleX+this.y*t.skewY,this.x*t.skewX+this.y*t.scaleY)}mul(e){const t=new Le(e);return new Le(this.x*t.x,this.y*t.y)}div(e){const t=new Le(e);return new Le(this.x/t.x,this.y/t.y)}add(e){const t=new Le(e);return new Le(this.x+t.x,this.y+t.y)}sub(e){const t=new Le(e);return new Le(this.x-t.x,this.y-t.y)}dot(e){const t=new Le(e);return this.x*t.x+this.y*t.y}cross(e){const t=new Le(e);return this.x*t.y-this.y*t.x}mod(e){const t=new Le(e);return new Le(this.x%t.x,this.y%t.y)}rotate(e,t){void 0===t&&(t=Le.zero);const s=new Le(t),i=Ee.fromTranslation(s).rotate(e).translate(s.flipped);return this.transformAsPoint(i)}addX(e){return new Le(this.x+e,this.y)}addY(e){return new Le(this.x,this.y+e)}toSymbol(){return Le.symbol}toString(){return`Vector2(${this.x}, ${this.y})`}serialize(){return{x:this.x,y:this.y}}exactlyEquals(e){return this.x===e.x&&this.y===e.y}equals(e,t){return void 0===t&&(t=Re),Math.abs(this.x-e.x)<=t+Number.EPSILON&&Math.abs(this.y-e.y)<=t+Number.EPSILON}}Le.symbol=Symbol.for("@motion-canvas/core/types/Vector2"),Le.zero=new Le,Le.one=new Le(1,1),Le.right=new Le(1,0),Le.left=new Le(-1,0),Le.up=new Le(0,1),Le.down=new Le(0,-1);const Ae="motion-canvas-player";class Ne extends HTMLElement{constructor(){super(),U(this,"root"),U(this,"canvas"),U(this,"overlay"),U(this,"button"),U(this,"state","initial"),U(this,"project",null),U(this,"player",null),U(this,"defaultSettings"),U(this,"abortController",null),U(this,"mouseMoveId",null),U(this,"finished",!1),U(this,"playing",!1),U(this,"connected",!1),U(this,"stage",new B),U(this,"handleMouseMove",(()=>{this.mouseMoveId&&clearTimeout(this.mouseMoveId),this.hover&&!this.playing&&this.setPlaying(!0),this.mouseMoveId=window.setTimeout((()=>{this.mouseMoveId=null,this.updateClass()}),2e3),this.updateClass()})),U(this,"handleMouseLeave",(()=>{this.hover&&this.setPlaying(!1),this.mouseMoveId&&(clearTimeout(this.mouseMoveId),this.mouseMoveId=null,this.updateClass())})),U(this,"handleMouseDown",(e=>{e.preventDefault()})),U(this,"handleClick",(()=>{this.auto||(this.handleMouseMove(),this.setPlaying(!this.playing),this.button.animate([{scale:"0.9"},{scale:"1",easing:"ease-out"}],{duration:200}))})),U(this,"render",(async()=>{this.player&&await this.stage.render(this.player.playback.currentScene,this.player.playback.previousScene)})),this.root=this.attachShadow({mode:"open"}),this.root.innerHTML='<style>.initial{display:none}.state-initial .initial{display:block}.loading{display:none}.state-loading .loading{display:block}.ready{display:none}.state-ready .ready{display:block}.error{display:none}.state-error .error{display:block}:host{position:relative;display:block}.overlay{position:absolute;left:0;right:0;top:0;bottom:0;display:flex;align-items:center;justify-content:center;opacity:0;background-color:#0000008a;transition:opacity .1s}.overlay.state-ready:not(.auto){cursor:pointer}.overlay.playing:not(.hover):hover{cursor:none}.overlay.hover,.overlay.state-ready:focus-within,.overlay.state-ready:not(.playing){opacity:1}.overlay.hover .button,.overlay.state-ready:focus-within .button,.overlay.state-ready:not(.playing) .button{scale:1;transition:scale .1s ease-out}.overlay.state-loading,.overlay.state-error{opacity:1;transition:opacity 1s}.overlay.state-ready.auto{opacity:0}.button{width:50%;max-width:96px;aspect-ratio:1;scale:.5;transition:scale .1s ease-in,opacity .1s;background-color:transparent;border:none;background-size:100% 100%;background-repeat:no-repeat;opacity:.54;cursor:inherit;background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjRweCIgdmlld0JveD0iMCAwIDI0IDI0IiB3aWR0aD0iMjRweCIgZmlsbD0iI2ZmZmZmZiI+PHBhdGggZD0iTTAgMGgyNHYyNEgwVjB6IiBmaWxsPSJub25lIi8+PHBhdGggZD0iTTEyIDJDNi40OCAyIDIgNi40OCAyIDEyczQuNDggMTAgMTAgMTAgMTAtNC40OCAxMC0xMFMxNy41MiAyIDEyIDJ6bS0yIDE0LjV2LTlsNiA0LjUtNiA0LjV6Ii8+PC9zdmc+)}.playing .button{background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDI0IDI0IiBoZWlnaHQ9IjI0cHgiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0cHgiIGZpbGw9IiNmZmZmZmYiPjxnPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iMjQiIHdpZHRoPSIyNCIvPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iMjQiIHdpZHRoPSIyNCIvPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iMjQiIHdpZHRoPSIyNCIvPjwvZz48Zz48Zy8+PHBhdGggZD0iTTEyLDJDNi40OCwyLDIsNi40OCwyLDEyczQuNDgsMTAsMTAsMTBzMTAtNC40OCwxMC0xMFMxNy41MiwyLDEyLDJ6IE0xMSwxNkg5VjhoMlYxNnogTTE1LDE2aC0yVjhoMlYxNnoiLz48L2c+PC9zdmc+)}.button:focus,.overlay:hover .button{opacity:.87}.auto .button{display:none}.canvas{width:100%;display:block;opacity:0;transition:opacity .1s}.canvas.state-ready{opacity:1}.message{font-family:JetBrains Mono,sans-serif;text-align:center;font-size:20px;padding:8px 16px;margin:16px;border-radius:4px;color:#fff9;background-color:#000000de}.loader{width:50%;max-width:96px;display:none;rotate:-90deg;animation:stroke 2s cubic-bezier(.5,0,.5,1) infinite,rotate 2s linear infinite}@keyframes stroke{0%{stroke-dasharray:5.6548667765px 50.8938009883px;stroke-dashoffset:2.8274333882px}50%{stroke-dasharray:50.8938009883px 5.6548667765px;stroke-dashoffset:-2.8274333882px}to{stroke-dasharray:5.6548667765px 50.8938009883px;stroke-dashoffset:-53.7212343766px}}@keyframes rotate{0%{rotate:-110deg}to{rotate:250deg}}\n</style><div class="overlay">\n  <button title="Play / Pause" class="button ready" tabindex="0"></button>\n  <div class="message error">\n    An error occurred while loading the animation.\n  </div>\n  <svg\n    class="loader loading"\n    viewBox="0 0 24 24"\n    stroke="#ffffff"\n    stroke-width="2"\n    fill="transparent"\n  >\n    <circle cx="12" cy="12" r="9" />\n  </svg>\n</div>\n',this.overlay=this.root.querySelector(".overlay"),this.button=this.root.querySelector(".button"),this.canvas=this.stage.finalBuffer,this.canvas.classList.add("canvas"),this.root.prepend(this.canvas),this.overlay.addEventListener("click",this.handleClick),this.overlay.addEventListener("mousemove",this.handleMouseMove),this.overlay.addEventListener("mouseleave",this.handleMouseLeave),this.button.addEventListener("mousedown",this.handleMouseDown),this.setState("initial")}static get observedAttributes(){return["src","quality","width","height","auto","variables"]}get auto(){return!!this.getAttribute("auto")}get hover(){return"hover"===this.getAttribute("auto")}get quality(){const e=this.getAttribute("quality");return e?parseFloat(e):this.defaultSettings.resolutionScale}get width(){const e=this.getAttribute("width");return e?parseFloat(e):this.defaultSettings.size.width}get height(){const e=this.getAttribute("height");return e?parseFloat(e):this.defaultSettings.size.height}get variables(){try{const e=this.getAttribute("variables");return e?JSON.parse(e):{}}catch{return this.project.logger.warn("Project variables could not be parsed."),{}}}setState(e){this.state=e,this.setPlaying(this.playing)}setPlaying(e){var t,s;"ready"===this.state&&(e||this.auto&&!this.hover)?(null==(t=this.player)||t.togglePlayback(!0),this.playing=!0):(null==(s=this.player)||s.togglePlayback(!1),this.playing=!1),this.updateClass()}updateClass(){this.overlay.className=`overlay state-${this.state}`,this.canvas.className=`canvas state-${this.state}`,this.overlay.classList.toggle("playing",this.playing),this.overlay.classList.toggle("auto",this.auto),this.overlay.classList.toggle("hover",null!==this.mouseMoveId),this.connected&&(null===this.mouseMoveId&&this.playing?delete this.dataset.overlay:this.dataset.overlay="")}async updateSource(e){var t,s,i,r;let a;this.setState("initial"),null==(t=this.abortController)||t.abort(),this.abortController=new AbortController;try{const t=import(e),s=new Promise((e=>setTimeout(e,200)));await Promise.any([s,t]),this.setState("loading"),a=(await t).default}catch(o){return console.error(o),void this.setState("error")}this.defaultSettings=a.meta.getFullRenderingSettings();const n=new $(a);n.setVariables(this.variables),this.finished=!1,null==(s=this.player)||s.onRender.unsubscribe(this.render),null==(i=this.player)||i.togglePlayback(!1),null==(r=this.player)||r.deactivate(),this.project=a,this.player=n,this.updateSettings(),this.player.onRender.subscribe(this.render),this.player.togglePlayback(this.playing),this.setState("ready")}attributeChangedCallback(e,t,s){var i;switch(e){case"auto":this.setPlaying(this.playing);break;case"src":this.updateSource(s);break;case"quality":case"width":case"height":this.updateSettings();break;case"variables":null==(i=this.player)||i.setVariables(this.variables)}}disconnectedCallback(){var e,t;this.connected=!1,null==(e=this.player)||e.deactivate(),null==(t=this.player)||t.onRender.unsubscribe(this.render)}connectedCallback(){var e,t;this.connected=!0,null==(e=this.player)||e.activate(),null==(t=this.player)||t.onRender.subscribe(this.render)}updateSettings(){const e={...this.defaultSettings,size:new Le(this.width,this.height),resolutionScale:this.quality};this.stage.configure(e),this.player.configure(e)}}customElements.get(Ae)||customElements.define(Ae,Ne)}}]);