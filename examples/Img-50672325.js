import{u as g,R as w,D as y,Q as S,Z as v,g as p,E,s as d,i as f,q as u}from"./makeScene2D-7ecb8e0c.js";function R(r){if(!m()||r.startsWith("/cors-proxy/"))return r;const e=new URL(window.location.toString());try{const t=new URL(r,e);if(!t.protocol.startsWith("http")||e.host===t.host||!C(t.host))return r}catch{return r}return`/cors-proxy/${encodeURIComponent(r)}`}function C(r){const e=L();if(e.length===0)return!0;for(const t of e)if(t.toLowerCase().trim()===r)return!0;return!1}function m(){return!1}let c;function L(){return{}.VITEST!=="true"&&c?[...c]:(c=function(){if(!m()||!{VITE_MC_PROXY_ENABLED:"false",BASE_URL:"/examples/",MODE:"production",DEV:!1,PROD:!0,SSR:!1})return[];const e={}.VITE_MC_PROXY_ALLOW_LIST??"[]",t=JSON.parse(e);Array.isArray(t)||g().error("Parsed Allow List expected to be an Array, but is "+typeof t);const i=[];for(const n of t){if(typeof n!="string"){g().warn("Unexpected Value in Allow List: "+n+". Expected a String. Skipping.");continue}i.push(n)}return i}(),[...c])}var s=globalThis&&globalThis.__decorate||function(r,e,t,i){var n=arguments.length,o=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,i);else for(var h=r.length-1;h>=0;h--)(l=r[h])&&(o=(n<3?l(o):n>3?l(e,t,o):l(e,t))||o);return n>3&&o&&Object.defineProperty(e,t,o),o};class a extends w{constructor(e){super(e)}desiredSize(){const e=super.desiredSize();if(e.x===null&&e.y===null){const t=this.image();return{x:t.naturalWidth,y:t.naturalHeight}}return e}image(){const e=R(this.src()),t=new URL(e,window.location.origin);if(t.origin===window.location.origin){const n=this.view().assetHash();t.searchParams.set("asset-hash",n)}let i=a.pool[e];return i||(i=document.createElement("img"),i.crossOrigin="anonymous",i.src=t.toString(),a.pool[e]=i),i.complete||y.collectPromise(new Promise((n,o)=>{i.addEventListener("load",n),i.addEventListener("error",o)})),i}imageCanvas(){const e=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});if(!e)throw new Error("Could not create an image canvas");return e}filledImageCanvas(){const e=this.imageCanvas(),t=this.image();return e.canvas.width=t.naturalWidth,e.canvas.height=t.naturalHeight,e.imageSmoothingEnabled=this.smoothing(),e.drawImage(t,0,0),e}draw(e){this.drawShape(e);const t=this.alpha();if(t>0){const i=S.fromSizeCentered(this.computedSize());e.save(),e.clip(this.getPath()),t<1&&(e.globalAlpha*=t),e.imageSmoothingEnabled=this.smoothing(),v(e,this.image(),i),e.restore()}this.clip()&&e.clip(this.getPath()),this.drawChildren(e)}applyFlex(){super.applyFlex();const e=this.image();this.element.style.aspectRatio=(this.ratio()??e.naturalWidth/e.naturalHeight).toString()}getColorAtPoint(e){const t=this.computedSize(),i=this.naturalSize(),n=new p(e).add(this.computedSize().scale(.5)).mul(i.div(t).safe);return this.getPixelColor(n)}naturalSize(){const e=this.image();return new p(e.naturalWidth,e.naturalHeight)}getPixelColor(e){const t=this.filledImageCanvas(),i=new p(e),n=t.getImageData(i.x,i.y,1,1).data;return new E({r:n[0],g:n[1],b:n[2],a:n[3]/255})}collectAsyncResources(){super.collectAsyncResources(),this.image()}}a.pool={};s([d()],a.prototype,"src",void 0);s([f(1),d()],a.prototype,"alpha",void 0);s([f(!0),d()],a.prototype,"smoothing",void 0);s([u()],a.prototype,"image",null);s([u()],a.prototype,"imageCanvas",null);s([u()],a.prototype,"filledImageCanvas",null);s([u()],a.prototype,"naturalSize",null);export{a as I};
