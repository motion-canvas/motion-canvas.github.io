import{S as u,T as g,i as y,a3 as T,s as w,r as x,a4 as c,a5 as C,a6 as R}from"./makeScene2D-2ac2c549.js";var d=globalThis&&globalThis.__decorate||function(a,e,t,i){var n=arguments.length,r=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,t,i);else for(var s=a.length-1;s>=0;s--)(l=a[s])&&(r=(n<3?l(r):n>3?l(e,t,r):l(e,t))||r);return n>3&&r&&Object.defineProperty(e,t,r),r};class o extends u{constructor({children:e,...t}){super(t),e&&this.text(e)}draw(e){this.requestFontUpdate(),this.applyStyle(e),this.applyText(e),e.font=this.styles.font,"letterSpacing"in e&&(e.letterSpacing=`${this.letterSpacing()}px`);const t=this.element.getBoundingClientRect(),{width:i,height:n}=this.size(),r=document.createRange();let l="";const s=new g;for(const p of this.element.childNodes){if(!p.textContent)continue;r.selectNodeContents(p);const h=r.getBoundingClientRect(),m=i/-2+h.left-t.left,f=n/-2+h.top-t.top;s.y===f?(s.width+=h.width,l+=p.textContent):(this.drawText(e,l,s),s.x=m,s.y=f,s.width=h.width,s.height=h.height,l=p.textContent)}this.drawText(e,l,s)}drawText(e,t,i){const n=i.y+i.height/2;e.save(),e.textBaseline="middle",this.lineWidth()<=0?e.fillText(t,i.x,n):this.strokeFirst()?(e.strokeText(t,i.x,n),e.fillText(t,i.x,n)):(e.fillText(t,i.x,n),e.strokeText(t,i.x,n)),e.restore()}formattedText(){return o.formatter.innerText=this.text(),o.formatter.innerText}updateLayout(){if(this.applyFont(),this.applyFlex(),this.justifyContent.isInitial()&&(this.element.style.justifyContent=this.styles.getPropertyValue("text-align")),this.styles.whiteSpace!=="nowrap"&&this.styles.whiteSpace!=="pre")if(this.element.innerText="",o.segmenter)for(const t of o.segmenter.segment(this.formattedText()))this.element.appendChild(document.createTextNode(t.segment));else for(const t of this.formattedText().split(""))this.element.appendChild(document.createTextNode(t));else if(this.styles.whiteSpace==="pre"){this.element.innerText="";for(const t of this.text().split(`
`))this.element.appendChild(document.createTextNode(t+`
`))}else this.element.innerText=this.formattedText()}}d([y(""),T(R),w()],o.prototype,"text",void 0);d([x()],o.prototype,"formattedText",null);d([c(()=>{const a=document.createElement("div");return C.shadowRoot.append(a),a})],o,"formatter",void 0);d([c(()=>{try{return new Intl.Segmenter(void 0,{granularity:"grapheme"})}catch{return null}})],o,"segmenter",void 0);export{o as T};
